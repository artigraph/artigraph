
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-7.3.0">
    
    
      
        <title>Graphs - artigraph</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-artigraphs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="artigraph" class="md-header__button md-logo" aria-label="artigraph" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            artigraph
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Graphs
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/artigraph/artigraph/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    artigraph
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="artigraph" class="md-nav__button md-logo" aria-label="artigraph" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    artigraph
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/artigraph/artigraph/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    artigraph
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CODE_OF_CONDUCT/" class="md-nav__link">
        Code Of Conduct
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CONTRIBUTING/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../GOVERNANCE/" class="md-nav__link">
        Governance
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../SECURITY/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../SUPPORT/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1" type="checkbox" id="__nav_8_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1">
          Arti
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Arti" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          Arti
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../annotations/" class="md-nav__link">
        Annotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../artifacts/" class="md-nav__link">
        Artifacts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fingerprints/" class="md-nav__link">
        Fingerprints
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Graphs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Graphs
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requires_sealed" class="md-nav__link">
    requires_sealed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artifactbox" class="md-nav__link">
    ArtifactBox
  </a>
  
    <nav class="md-nav" aria-label="ArtifactBox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_json" class="md-nav__link">
    from_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_msgpack" class="md-nav__link">
    from_msgpack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_toml" class="md-nav__link">
    from_toml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_yaml" class="md-nav__link">
    from_yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fromkeys" class="md-nav__link">
    fromkeys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get" class="md-nav__link">
    get
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#items" class="md-nav__link">
    items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keys" class="md-nav__link">
    keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge_update" class="md-nav__link">
    merge_update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#popitem" class="md-nav__link">
    popitem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault" class="md-nav__link">
    setdefault
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_dict" class="md-nav__link">
    to_dict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_json" class="md-nav__link">
    to_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_msgpack" class="md-nav__link">
    to_msgpack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_toml" class="md-nav__link">
    to_toml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_yaml" class="md-nav__link">
    to_yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values" class="md-nav__link">
    values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#walk" class="md-nav__link">
    walk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph" class="md-nav__link">
    Graph
  </a>
  
    <nav class="md-nav" aria-label="Graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods_1" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct" class="md-nav__link">
    construct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_orm" class="md-nav__link">
    from_orm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_file" class="md-nav__link">
    parse_file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_obj" class="md-nav__link">
    parse_obj
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_raw" class="md-nav__link">
    parse_raw
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema" class="md-nav__link">
    schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema_json" class="md-nav__link">
    schema_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_forward_refs" class="md-nav__link">
    update_forward_refs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    validate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy_1" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dict" class="md-nav__link">
    dict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#producer_outputs" class="md-nav__link">
    producer_outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#producers" class="md-nav__link">
    producers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snapshot" class="md-nav__link">
    snapshot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphsnapshot" class="md-nav__link">
    GraphSnapshot
  </a>
  
    <nav class="md-nav" aria-label="GraphSnapshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables_1" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods_2" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct_1" class="md-nav__link">
    construct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_graph" class="md-nav__link">
    from_graph
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_orm_1" class="md-nav__link">
    from_orm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_tag" class="md-nav__link">
    from_tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_file_1" class="md-nav__link">
    parse_file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_obj_1" class="md-nav__link">
    parse_obj
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_raw_1" class="md-nav__link">
    parse_raw
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema_1" class="md-nav__link">
    schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema_json_1" class="md-nav__link">
    schema_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_forward_refs_1" class="md-nav__link">
    update_forward_refs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate_1" class="md-nav__link">
    validate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build_1" class="md-nav__link">
    build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy_2" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dict_1" class="md-nav__link">
    dict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_1" class="md-nav__link">
    json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_1" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag" class="md-nav__link">
    tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_1" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../partitions/" class="md-nav__link">
        Partitions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../producers/" class="md-nav__link">
        Producers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../statistics/" class="md-nav__link">
        Statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../thresholds/" class="md-nav__link">
        Thresholds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../versions/" class="md-nav__link">
        Versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_11" type="checkbox" id="__nav_8_1_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_11">
          Backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Backends" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_11">
          <span class="md-nav__icon md-icon"></span>
          Backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../backends/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../backends/memory/" class="md-nav__link">
        Memory
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_12" type="checkbox" id="__nav_8_1_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_12">
          Executors
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Executors" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_12">
          <span class="md-nav__icon md-icon"></span>
          Executors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../executors/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../executors/local/" class="md-nav__link">
        Local
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_13" type="checkbox" id="__nav_8_1_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_13">
          Formats
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Formats" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_13">
          <span class="md-nav__icon md-icon"></span>
          Formats
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../formats/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../formats/json/" class="md-nav__link">
        Json
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../formats/pickle/" class="md-nav__link">
        Pickle
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_14" type="checkbox" id="__nav_8_1_14" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_14">
          Internal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Internal" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_14">
          <span class="md-nav__icon md-icon"></span>
          Internal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../internal/dispatch/" class="md-nav__link">
        Dispatch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../internal/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../internal/models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../internal/patches/" class="md-nav__link">
        Patches
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../internal/type_hints/" class="md-nav__link">
        Type Hints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../internal/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_15" type="checkbox" id="__nav_8_1_15" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_15">
          Io
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Io" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_15">
          <span class="md-nav__icon md-icon"></span>
          Io
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/json_gcsfile_python/" class="md-nav__link">
        Json Gcsfile Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/json_localfile_python/" class="md-nav__link">
        Json Localfile Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/json_stringliteral_python/" class="md-nav__link">
        Json Stringliteral Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/pickle_gcsfile_python/" class="md-nav__link">
        Pickle Gcsfile Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/pickle_localfile_python/" class="md-nav__link">
        Pickle Localfile Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_16" type="checkbox" id="__nav_8_1_16" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_16">
          Storage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Storage" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_16">
          <span class="md-nav__icon md-icon"></span>
          Storage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../storage/literal/" class="md-nav__link">
        Literal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../storage/local/" class="md-nav__link">
        Local
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_17" type="checkbox" id="__nav_8_1_17" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_17">
          Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Types" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_17">
          <span class="md-nav__icon md-icon"></span>
          Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/bigquery/" class="md-nav__link">
        Bigquery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/pyarrow/" class="md-nav__link">
        Pyarrow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/pydantic/" class="md-nav__link">
        Pydantic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/python/" class="md-nav__link">
        Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1_18" type="checkbox" id="__nav_8_1_18" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1_18">
          Views
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Views" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_1_18">
          <span class="md-nav__icon md-icon"></span>
          Views
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../views/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../views/python/" class="md-nav__link">
        Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requires_sealed" class="md-nav__link">
    requires_sealed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artifactbox" class="md-nav__link">
    ArtifactBox
  </a>
  
    <nav class="md-nav" aria-label="ArtifactBox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_json" class="md-nav__link">
    from_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_msgpack" class="md-nav__link">
    from_msgpack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_toml" class="md-nav__link">
    from_toml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_yaml" class="md-nav__link">
    from_yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fromkeys" class="md-nav__link">
    fromkeys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get" class="md-nav__link">
    get
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#items" class="md-nav__link">
    items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keys" class="md-nav__link">
    keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge_update" class="md-nav__link">
    merge_update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#popitem" class="md-nav__link">
    popitem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault" class="md-nav__link">
    setdefault
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_dict" class="md-nav__link">
    to_dict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_json" class="md-nav__link">
    to_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_msgpack" class="md-nav__link">
    to_msgpack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_toml" class="md-nav__link">
    to_toml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_yaml" class="md-nav__link">
    to_yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values" class="md-nav__link">
    values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#walk" class="md-nav__link">
    walk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph" class="md-nav__link">
    Graph
  </a>
  
    <nav class="md-nav" aria-label="Graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods_1" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct" class="md-nav__link">
    construct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_orm" class="md-nav__link">
    from_orm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_file" class="md-nav__link">
    parse_file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_obj" class="md-nav__link">
    parse_obj
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_raw" class="md-nav__link">
    parse_raw
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema" class="md-nav__link">
    schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema_json" class="md-nav__link">
    schema_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_forward_refs" class="md-nav__link">
    update_forward_refs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    validate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy_1" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dict" class="md-nav__link">
    dict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#producer_outputs" class="md-nav__link">
    producer_outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#producers" class="md-nav__link">
    producers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snapshot" class="md-nav__link">
    snapshot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphsnapshot" class="md-nav__link">
    GraphSnapshot
  </a>
  
    <nav class="md-nav" aria-label="GraphSnapshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables_1" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods_2" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct_1" class="md-nav__link">
    construct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_graph" class="md-nav__link">
    from_graph
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_orm_1" class="md-nav__link">
    from_orm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_tag" class="md-nav__link">
    from_tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_file_1" class="md-nav__link">
    parse_file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_obj_1" class="md-nav__link">
    parse_obj
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_raw_1" class="md-nav__link">
    parse_raw
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema_1" class="md-nav__link">
    schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema_json_1" class="md-nav__link">
    schema_json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_forward_refs_1" class="md-nav__link">
    update_forward_refs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate_1" class="md-nav__link">
    validate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build_1" class="md-nav__link">
    build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy_2" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dict_1" class="md-nav__link">
    dict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_1" class="md-nav__link">
    json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_1" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag" class="md-nav__link">
    tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_1" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/artigraph/artigraph/edit/golden/reference/arti/graphs.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="module-artigraphs">Module arti.graphs</h1>
<p>None</p>
<p>None</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="n">__path__</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s2">&quot;pkgutil&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extend_path</span><span class="p">(</span><span class="n">__path__</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cached_property</span><span class="p">,</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">graphlib</span> <span class="kn">import</span> <span class="n">TopologicalSorter</span>

<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">TracebackType</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">PrivateAttr</span><span class="p">,</span> <span class="n">validator</span>

<span class="kn">import</span> <span class="nn">arti</span>

<span class="kn">from</span> <span class="nn">arti</span> <span class="kn">import</span> <span class="n">io</span>

<span class="kn">from</span> <span class="nn">arti.artifacts</span> <span class="kn">import</span> <span class="n">Artifact</span>

<span class="kn">from</span> <span class="nn">arti.backends</span> <span class="kn">import</span> <span class="n">Backend</span><span class="p">,</span> <span class="n">Connection</span>

<span class="kn">from</span> <span class="nn">arti.fingerprints</span> <span class="kn">import</span> <span class="n">Fingerprint</span>

<span class="kn">from</span> <span class="nn">arti.internal.models</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="kn">from</span> <span class="nn">arti.internal.utils</span> <span class="kn">import</span> <span class="n">TypedBox</span><span class="p">,</span> <span class="n">frozendict</span>

<span class="kn">from</span> <span class="nn">arti.partitions</span> <span class="kn">import</span> <span class="n">CompositeKey</span>

<span class="kn">from</span> <span class="nn">arti.producers</span> <span class="kn">import</span> <span class="n">Producer</span>

<span class="kn">from</span> <span class="nn">arti.storage</span> <span class="kn">import</span> <span class="n">StoragePartition</span><span class="p">,</span> <span class="n">StoragePartitions</span>

<span class="kn">from</span> <span class="nn">arti.types</span> <span class="kn">import</span> <span class="n">is_partitioned</span>

<span class="kn">from</span> <span class="nn">arti.views</span> <span class="kn">import</span> <span class="n">View</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>

    <span class="kn">from</span> <span class="nn">arti.backends.memory</span> <span class="kn">import</span> <span class="n">MemoryBackend</span>

    <span class="kn">from</span> <span class="nn">arti.executors</span> <span class="kn">import</span> <span class="n">Executor</span>

<span class="k">else</span><span class="p">:</span>

    <span class="kn">from</span> <span class="nn">arti.internal.patches</span> <span class="kn">import</span> <span class="n">patch_TopologicalSorter_class_getitem</span>

    <span class="n">patch_TopologicalSorter_class_getitem</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_get_memory_backend</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MemoryBackend</span><span class="p">:</span>

    <span class="c1"># Avoid importing non-root modules upon import</span>

    <span class="kn">from</span> <span class="nn">arti.backends.memory</span> <span class="kn">import</span> <span class="n">MemoryBackend</span>

    <span class="k">return</span> <span class="n">MemoryBackend</span><span class="p">()</span>

<span class="n">SEALED</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">OPEN</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">BOX_KWARGS</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">status</span><span class="p">:</span> <span class="p">{</span>

        <span class="s2">&quot;box_dots&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

        <span class="s2">&quot;default_box&quot;</span><span class="p">:</span> <span class="n">status</span> <span class="ow">is</span> <span class="n">OPEN</span><span class="p">,</span>

        <span class="s2">&quot;frozen_box&quot;</span><span class="p">:</span> <span class="n">status</span> <span class="ow">is</span> <span class="n">SEALED</span><span class="p">,</span>

    <span class="p">}</span>

    <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OPEN</span><span class="p">,</span> <span class="n">SEALED</span><span class="p">)</span>

<span class="p">}</span>

<span class="n">_Return</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_Return&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">requires_sealed</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_Return</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_Return</span><span class="p">]:</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_if_sealed</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Return</span><span class="p">:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SEALED</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> cannot be used while the Graph is still being defined&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">check_if_sealed</span>

<span class="k">class</span> <span class="nc">ArtifactBox</span><span class="p">(</span><span class="n">TypedBox</span><span class="p">[</span><span class="n">Artifact</span><span class="p">]):</span>

    <span class="k">def</span> <span class="nf">_TypedBox__cast_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Artifact</span><span class="p">:</span>

        <span class="n">artifact</span><span class="p">:</span> <span class="n">Artifact</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_TypedBox__cast_value</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>

        <span class="n">storage</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">storage</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">graph</span> <span class="o">:=</span> <span class="n">arti</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">_visit_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span><span class="o">.</span><span class="n">_visit_names</span><span class="p">(</span>

                <span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_box_config</span><span class="p">[</span><span class="s2">&quot;box_namespace&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">)</span>

            <span class="p">)</span>

        <span class="c1"># Require an {input_fingerprint} template in the Storage if this Artifact is being generated</span>

        <span class="c1"># by a Producer. Otherwise, strip the {input_fingerprint} template (if set) for &quot;raw&quot;</span>

        <span class="c1"># Artifacts.</span>

        <span class="c1">#</span>

        <span class="c1"># We can&#39;t validate this at Artifact instantiation because the Producer is tracked later (by</span>

        <span class="c1"># copying the instance and setting the `producer_output` attribute). We won&#39;t know the</span>

        <span class="c1"># &quot;final&quot; instance until assignment here to the Graph.</span>

        <span class="k">if</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">_visit_input_fingerprint</span><span class="p">(</span><span class="n">Fingerprint</span><span class="o">.</span><span class="n">empty</span><span class="p">())</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">artifact</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">includes_input_fingerprint_template</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>

                <span class="s2">&quot;Produced Artifacts must have a &#39;</span><span class="si">{input_fingerprint}</span><span class="s2">&#39; template in their Storage&quot;</span>

            <span class="p">)</span>

        <span class="k">return</span> <span class="n">artifact</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;storage&quot;</span><span class="p">:</span> <span class="n">storage</span><span class="p">})</span>

<span class="n">Node</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Artifact</span><span class="p">,</span> <span class="n">Producer</span><span class="p">]</span>

<span class="n">NodeDependencies</span> <span class="o">=</span> <span class="n">frozendict</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">Node</span><span class="p">]]</span>

<span class="k">class</span> <span class="nc">Graph</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Graph stores a web of Artifacts connected by Producers.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="n">artifacts</span><span class="p">:</span> <span class="n">ArtifactBox</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">ArtifactBox</span><span class="p">(</span><span class="o">**</span><span class="n">BOX_KWARGS</span><span class="p">[</span><span class="n">SEALED</span><span class="p">]))</span>

    <span class="c1"># The Backend *itself* should not affect the results of a Graph build, though the contents</span>

    <span class="c1"># certainly may (eg: stored annotations), so we avoid serializing it. This also prevent</span>

    <span class="c1"># embedding any credentials.</span>

    <span class="n">backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">_get_memory_backend</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">path_tags</span><span class="p">:</span> <span class="n">frozendict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">frozendict</span><span class="p">()</span>

    <span class="c1"># Graph starts off sealed, but is opened within a `with Graph(...)` context</span>

    <span class="n">_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">PrivateAttr</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">_artifact_to_key</span><span class="p">:</span> <span class="n">frozendict</span><span class="p">[</span><span class="n">Artifact</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">PrivateAttr</span><span class="p">(</span><span class="n">frozendict</span><span class="p">())</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;artifacts&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>

    <span class="k">def</span> <span class="nf">_convert_artifacts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">artifacts</span><span class="p">:</span> <span class="n">ArtifactBox</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArtifactBox</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">ArtifactBox</span><span class="p">(</span><span class="n">artifacts</span><span class="p">,</span> <span class="o">**</span><span class="n">BOX_KWARGS</span><span class="p">[</span><span class="n">SEALED</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">arti</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Another graph is being defined: </span><span class="si">{</span><span class="n">arti</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">graph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">arti</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_toggle</span><span class="p">(</span><span class="n">OPEN</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span>

        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>

        <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>

        <span class="n">exc_traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">],</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">arti</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_toggle</span><span class="p">(</span><span class="n">SEALED</span><span class="p">)</span>

        <span class="c1"># Confirm the dependencies are acyclic</span>

        <span class="n">TopologicalSorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># The Graph object is &quot;frozen&quot;, so we must bypass the assignment checks.</span>

        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;artifacts&quot;</span><span class="p">,</span> <span class="n">ArtifactBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">artifacts</span><span class="p">,</span> <span class="o">**</span><span class="n">BOX_KWARGS</span><span class="p">[</span><span class="n">status</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_artifact_to_key</span> <span class="o">=</span> <span class="n">frozendict</span><span class="p">(</span>

            <span class="p">{</span><span class="n">artifact</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artifacts</span><span class="o">.</span><span class="n">walk</span><span class="p">()}</span>

        <span class="p">)</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">artifact_to_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">frozendict</span><span class="p">[</span><span class="n">Artifact</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifact_to_key</span>

    <span class="nd">@requires_sealed</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">executor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Executor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphSnapshot</span><span class="p">:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

    <span class="nd">@requires_sealed</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify a &quot;unique&quot; ID for this Graph at this point in time.</span>

<span class="sd">        The ID aims to encode the structure of the Graph plus a _snapshot_ of the raw Artifact data</span>

<span class="sd">        (partition kinds and contents). Any change that would affect data should prompt an ID</span>

<span class="sd">        change, however changes to this ID don&#39;t directly cause data to be reproduced.</span>

<span class="sd">        NOTE: There is currently a gap (and thus race condition) between when the Graph ID is</span>

<span class="sd">        computed and when we read raw Artifacts data during Producer builds.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">GraphSnapshot</span><span class="o">.</span><span class="n">from_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>

    <span class="nd">@cached_property</span>

    <span class="nd">@requires_sealed</span>

    <span class="k">def</span> <span class="nf">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NodeDependencies</span><span class="p">:</span>

        <span class="n">artifact_deps</span> <span class="o">=</span> <span class="p">{</span>

            <span class="n">artifact</span><span class="p">:</span> <span class="p">(</span>

                <span class="nb">frozenset</span><span class="p">({</span><span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span><span class="o">.</span><span class="n">producer</span><span class="p">})</span>

                <span class="k">if</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

                <span class="k">else</span> <span class="nb">frozenset</span><span class="p">()</span>

            <span class="p">)</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artifacts</span><span class="o">.</span><span class="n">walk</span><span class="p">()</span>

        <span class="p">}</span>

        <span class="n">producer_deps</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># NOTE: multi-output Producers will appear multiple times (but be deduped)</span>

            <span class="n">producer_output</span><span class="o">.</span><span class="n">producer</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">producer_output</span><span class="o">.</span><span class="n">producer</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">artifact_deps</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">producer_output</span> <span class="o">:=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="p">}</span>

        <span class="k">return</span> <span class="n">NodeDependencies</span><span class="p">(</span><span class="n">artifact_deps</span> <span class="o">|</span> <span class="n">producer_deps</span><span class="p">)</span>

    <span class="nd">@cached_property</span>

    <span class="nd">@requires_sealed</span>

    <span class="k">def</span> <span class="nf">producers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">Producer</span><span class="p">]:</span>

        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">producer_outputs</span><span class="p">)</span>

    <span class="nd">@cached_property</span>

    <span class="nd">@requires_sealed</span>

    <span class="k">def</span> <span class="nf">producer_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">frozendict</span><span class="p">[</span><span class="n">Producer</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Artifact</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">[</span><span class="n">Producer</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Artifact</span><span class="p">]](</span><span class="nb">dict</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artifacts</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">continue</span>

            <span class="n">output</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span>

            <span class="n">d</span><span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">producer</span><span class="p">][</span><span class="n">output</span><span class="o">.</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="n">artifact</span>

        <span class="k">return</span> <span class="n">frozendict</span><span class="p">(</span>

            <span class="p">(</span><span class="n">producer</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">artifacts_by_position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">artifacts_by_position</span><span class="p">)))</span>

            <span class="k">for</span> <span class="n">producer</span><span class="p">,</span> <span class="n">artifacts_by_position</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

        <span class="p">)</span>

    <span class="c1"># TODO: io.read/write probably need a bit of sanity checking (probably somewhere else), eg: type</span>

    <span class="c1"># ~= view. Doing validation on the data, etc. Should some of this live on the View?</span>

    <span class="nd">@requires_sealed</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span>

        <span class="n">artifact</span><span class="p">:</span> <span class="n">Artifact</span><span class="p">,</span>

        <span class="o">*</span><span class="p">,</span>

        <span class="n">annotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">storage_partitions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">StoragePartition</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">view</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">View</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">snapshot</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GraphSnapshot</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>

        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">artifact_to_key</span><span class="p">[</span><span class="n">artifact</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">view</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `annotation` or `view` must be passed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">view</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only one of `annotation` or `view` may be passed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="n">get_class_for</span><span class="p">(</span><span class="n">annotation</span><span class="p">)(</span>

                <span class="n">artifact_class</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">artifact</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">artifact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;READ&quot;</span>

            <span class="p">)</span>

            <span class="n">view</span><span class="o">.</span><span class="n">check_annotation_compatibility</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>

            <span class="n">view</span><span class="o">.</span><span class="n">check_artifact_compatibility</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">view</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># mypy gets mixed up with ^</span>

        <span class="k">if</span> <span class="n">storage_partitions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># We want to allow reading raw Artifacts even if other raw Artifacts are missing (which</span>

            <span class="c1"># prevents snapshotting).</span>

            <span class="k">if</span> <span class="n">snapshot</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># NOTE: We&#39;re not using read_artifact_partitions as the underlying data may have</span>

                <span class="c1"># changed. The backend may have pointers to old versions (which is expected), but we</span>

                <span class="c1"># only want to return the current values.</span>

                <span class="n">storage_partitions</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">discover_partitions</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">snapshot</span> <span class="o">=</span> <span class="n">snapshot</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot</span><span class="p">()</span>

                <span class="k">with</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

                    <span class="n">storage_partitions</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_snapshot_partitions</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">artifact</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>

            <span class="n">type_</span><span class="o">=</span><span class="n">artifact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>

            <span class="nb">format</span><span class="o">=</span><span class="n">artifact</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>

            <span class="n">storage_partitions</span><span class="o">=</span><span class="n">storage_partitions</span><span class="p">,</span>

            <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>

        <span class="p">)</span>

    <span class="nd">@requires_sealed</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span>

        <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>

        <span class="o">*</span><span class="p">,</span>

        <span class="n">artifact</span><span class="p">:</span> <span class="n">Artifact</span><span class="p">,</span>

        <span class="n">input_fingerprint</span><span class="p">:</span> <span class="n">Fingerprint</span> <span class="o">=</span> <span class="n">Fingerprint</span><span class="o">.</span><span class="n">empty</span><span class="p">(),</span>

        <span class="n">keys</span><span class="p">:</span> <span class="n">CompositeKey</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(),</span>

        <span class="n">view</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">View</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">snapshot</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GraphSnapshot</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StoragePartition</span><span class="p">:</span>

        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">artifact_to_key</span><span class="p">[</span><span class="n">artifact</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">snapshot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>

                <span class="sa">f</span><span class="s2">&quot;Writing to a raw Artifact (`</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`) with a GraphSnapshot is not supported.&quot;</span>

            <span class="p">)</span>

        <span class="k">if</span> <span class="n">view</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="n">get_class_for</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))(</span>

                <span class="n">artifact_class</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">artifact</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">artifact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;WRITE&quot;</span>

            <span class="p">)</span>

        <span class="n">view</span><span class="o">.</span><span class="n">check_annotation_compatibility</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

        <span class="n">view</span><span class="o">.</span><span class="n">check_artifact_compatibility</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>

        <span class="n">storage_partition</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">generate_partition</span><span class="p">(</span>

            <span class="n">input_fingerprint</span><span class="o">=</span><span class="n">input_fingerprint</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">with_content_fingerprint</span><span class="o">=</span><span class="kc">False</span>

        <span class="p">)</span>

        <span class="n">storage_partition</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>

            <span class="n">data</span><span class="p">,</span>

            <span class="n">type_</span><span class="o">=</span><span class="n">artifact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>

            <span class="nb">format</span><span class="o">=</span><span class="n">artifact</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>

            <span class="n">storage_partition</span><span class="o">=</span><span class="n">storage_partition</span><span class="p">,</span>

            <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>

        <span class="p">)</span><span class="o">.</span><span class="n">with_content_fingerprint</span><span class="p">()</span>

        <span class="c1"># TODO: Should we only do this in bulk? We might want the backends to transparently batch</span>

        <span class="c1"># requests, but that&#39;s not so friendly with the transient &quot;.connect&quot;.</span>

        <span class="k">with</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

            <span class="n">conn</span><span class="o">.</span><span class="n">write_artifact_partitions</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span> <span class="p">(</span><span class="n">storage_partition</span><span class="p">,))</span>

            <span class="c1"># Skip linking this partition to the snapshot if it affects raw Artifacts (which would</span>

            <span class="c1"># trigger an id change).</span>

            <span class="k">if</span> <span class="n">snapshot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">artifact</span><span class="o">.</span><span class="n">producer_output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">conn</span><span class="o">.</span><span class="n">write_snapshot_partitions</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">artifact</span><span class="p">,</span> <span class="p">(</span><span class="n">storage_partition</span><span class="p">,))</span>

        <span class="k">return</span> <span class="n">storage_partition</span>

<span class="k">class</span> <span class="nc">GraphSnapshot</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;GraphSnapshot represents the state of a Graph and the referenced raw data at a point in time.</span>

<span class="sd">    GraphSnapshot encodes the structure of the Graph plus a snapshot of the raw Artifact data</span>

<span class="sd">    (partition kinds and contents) at a point in time. Any change that would affect data should</span>

<span class="sd">    prompt an ID change.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="n">Fingerprint</span>

    <span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">artifacts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArtifactBox</span><span class="p">:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">artifacts</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">backend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Backend</span><span class="p">[</span><span class="n">Connection</span><span class="p">]:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">backend</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@classmethod</span>  <span class="c1"># TODO: Should this use a (TTL) cache? Raw data changes (especially in tests) still need to be detected.</span>

    <span class="k">def</span> <span class="nf">from_graph</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Snapshot the Graph and all existing raw data.</span>

<span class="sd">        NOTE: There is currently a gap (and thus race condition) between when the Graph ID is</span>

<span class="sd">        computed and when we read raw Artifact data during Producer builds.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: Resolve and statically set all available fingerprints. Specifically, we should pin</span>

        <span class="c1"># the Producer.fingerprint, which may by dynamic (eg: version is a Timestamp). Unbuilt</span>

        <span class="c1"># Artifact (partitions) won&#39;t be fully resolved yet.</span>

        <span class="n">snapshot_id</span><span class="p">,</span> <span class="n">known_artifact_partitions</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StoragePartitions</span><span class="p">]()</span>

        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">snapshot_id</span> <span class="o">=</span> <span class="n">snapshot_id</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Artifact</span><span class="p">):</span>

                <span class="n">key</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">artifact_to_key</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>

                <span class="n">snapshot_id</span> <span class="o">=</span> <span class="n">snapshot_id</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">Fingerprint</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

                <span class="c1"># Include fingerprints (including content_fingerprint!) for all raw Artifact</span>

                <span class="c1"># partitions, triggering a graph ID change if these artifacts change out-of-band.</span>

                <span class="c1">#</span>

                <span class="c1"># TODO: Should we *also* inspect Producer.inputs for Artifacts _not_ inside this</span>

                <span class="c1"># Graph and inspect their contents too? I guess we&#39;ll have to handle things a bit</span>

                <span class="c1"># differently depending on if the external Artifacts are Produced (in an upstream</span>

                <span class="c1"># Graph) or not.</span>

                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">producer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="n">known_artifact_partitions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">StoragePartitions</span><span class="p">(</span>

                        <span class="n">partition</span><span class="o">.</span><span class="n">with_content_fingerprint</span><span class="p">()</span>

                        <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">discover_partitions</span><span class="p">()</span>

                    <span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">known_artifact_partitions</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>

                        <span class="n">content_str</span> <span class="o">=</span> <span class="s2">&quot;partitions&quot;</span> <span class="k">if</span> <span class="n">is_partitioned</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;data&quot;</span>

                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">content_str</span><span class="si">}</span><span class="s2"> found for `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="n">snapshot_id</span> <span class="o">=</span> <span class="n">snapshot_id</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>

                        <span class="o">*</span><span class="p">[</span><span class="n">partition</span><span class="o">.</span><span class="n">fingerprint</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">known_artifact_partitions</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>

                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">snapshot_id</span><span class="o">.</span><span class="n">is_empty</span> <span class="ow">or</span> <span class="n">snapshot_id</span><span class="o">.</span><span class="n">is_identity</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>

            <span class="c1"># NOTE: This shouldn&#39;t happen unless the logic above is faulty.</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Fingerprint is empty!&quot;</span><span class="p">)</span>

        <span class="n">snapshot</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">snapshot_id</span><span class="p">)</span>

        <span class="c1"># Write the discovered partitions (if not already known) and link to this new snapshot.</span>

        <span class="k">with</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

            <span class="n">conn</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

            <span class="n">conn</span><span class="o">.</span><span class="n">write_snapshot</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">partitions</span> <span class="ow">in</span> <span class="n">known_artifact_partitions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">conn</span><span class="o">.</span><span class="n">write_artifact_and_graph_partitions</span><span class="p">(</span>

                    <span class="n">snapshot</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">artifacts</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">partitions</span>

                <span class="p">)</span>

        <span class="k">return</span> <span class="n">snapshot</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">executor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Executor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphSnapshot</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">executor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="kn">from</span> <span class="nn">arti.executors.local</span> <span class="kn">import</span> <span class="n">LocalExecutor</span>

            <span class="n">executor</span> <span class="o">=</span> <span class="n">LocalExecutor</span><span class="p">()</span>

        <span class="n">executor</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">tag</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">with</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

            <span class="n">conn</span><span class="o">.</span><span class="n">write_snapshot_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span>

    <span class="nd">@classmethod</span>

    <span class="k">def</span> <span class="nf">from_tag</span><span class="p">(</span>

        <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">connectable</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Backend</span><span class="p">[</span><span class="n">Connection</span><span class="p">],</span> <span class="n">Connection</span><span class="p">]</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphSnapshot</span><span class="p">:</span>

        <span class="k">with</span> <span class="n">connectable</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_snapshot_tag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span>

        <span class="n">artifact</span><span class="p">:</span> <span class="n">Artifact</span><span class="p">,</span>

        <span class="o">*</span><span class="p">,</span>

        <span class="n">annotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">storage_partitions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">StoragePartition</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">view</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">View</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>

            <span class="n">artifact</span><span class="p">,</span>

            <span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">,</span>

            <span class="n">storage_partitions</span><span class="o">=</span><span class="n">storage_partitions</span><span class="p">,</span>

            <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>

            <span class="n">snapshot</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>

            <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>

        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span>

        <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>

        <span class="o">*</span><span class="p">,</span>

        <span class="n">artifact</span><span class="p">:</span> <span class="n">Artifact</span><span class="p">,</span>

        <span class="n">input_fingerprint</span><span class="p">:</span> <span class="n">Fingerprint</span> <span class="o">=</span> <span class="n">Fingerprint</span><span class="o">.</span><span class="n">empty</span><span class="p">(),</span>

        <span class="n">keys</span><span class="p">:</span> <span class="n">CompositeKey</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(),</span>

        <span class="n">view</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">View</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StoragePartition</span><span class="p">:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>

            <span class="n">data</span><span class="p">,</span>

            <span class="n">artifact</span><span class="o">=</span><span class="n">artifact</span><span class="p">,</span>

            <span class="n">input_fingerprint</span><span class="o">=</span><span class="n">input_fingerprint</span><span class="p">,</span>

            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>

            <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>

            <span class="n">snapshot</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>

            <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>

        <span class="p">)</span>
</code></pre></div>

</details>
<h2 id="variables">Variables</h2>
<div class="codehilite"><pre><span></span><code><span class="n">BOX_KWARGS</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">Node</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">NodeDependencies</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">OPEN</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">SEALED</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">TYPE_CHECKING</span>
</code></pre></div>

<h2 id="functions">Functions</h2>
<h3 id="requires_sealed">requires_sealed</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">requires_sealed</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="s1">&#39;Callable[..., _Return]&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Callable[..., _Return]&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">requires_sealed</span><span class="p">(</span><span class="nl">fn</span><span class="p">:</span><span class="w"> </span><span class="n">Callable</span><span class="o">[</span><span class="n">..., _Return</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Callable</span><span class="o">[</span><span class="n">..., _Return</span><span class="o">]</span><span class="err">:</span>

<span class="w">    </span><span class="nv">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">check_if_sealed</span><span class="p">(</span><span class="nl">self</span><span class="p">:</span><span class="w"> </span><span class="n">Graph</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nl">args</span><span class="p">:</span><span class="w"> </span><span class="ow">Any</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nl">kwargs</span><span class="p">:</span><span class="w"> </span><span class="ow">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">_Return</span><span class="p">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_status</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">SEALED</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;{fn.__name__} cannot be used while the Graph is still being defined&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fn</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">check_if_sealed</span>
</code></pre></div>

</details>
<h2 id="classes">Classes</h2>
<h3 id="artifactbox">ArtifactBox</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ArtifactBox</span><span class="p">(</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">default_box</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">default_box_attr</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">object</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f1a4d988080</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">default_box_none_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">default_box_create_on_get</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">frozen_box</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">camel_killer_box</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">conversion_box</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">modify_tuples_box</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">box_safe_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span>
    <span class="n">box_duplicates</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
    <span class="n">box_intact_types</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="n">box_recast</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">box_dots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">box_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Box&#39;</span><span class="p">)],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">box_namespace</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">ArtifactBox</span><span class="p">(</span><span class="n">TypedBox</span><span class="o">[</span><span class="n">Artifact</span><span class="o">]</span><span class="p">)</span><span class="err">:</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_TypedBox__cast_value</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">item</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="err">:</span><span class="w"> </span><span class="ow">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">Artifact</span><span class="p">:</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">super</span><span class="p">().</span><span class="n">_TypedBox__cast_value</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="k">ignore</span><span class="o">[</span><span class="n">misc</span><span class="o">]</span>

<span class="w">        </span><span class="n">storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">storage</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">graph</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">arti</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">graph</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">_visit_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">).</span><span class="n">_visit_names</span><span class="p">(</span>

<span class="w">                </span><span class="p">(</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;box_namespace&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Require</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">{</span><span class="n">input_fingerprint</span><span class="err">}</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Storage</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">Artifact</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">generated</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Producer</span><span class="p">.</span><span class="w"> </span><span class="n">Otherwise</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">{</span><span class="n">input_fingerprint</span><span class="err">}</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="k">set</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ss">&quot;raw&quot;</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Artifacts</span><span class="p">.</span>

<span class="w">        </span><span class="err">#</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">can</span><span class="s1">&#39;t validate this at Artifact instantiation because the Producer is tracked later (by</span>

<span class="s1">        # copying the instance and setting the `producer_output` attribute). We won&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">the</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="ss">&quot;final&quot;</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Graph</span><span class="p">.</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">_visit_input_fingerprint</span><span class="p">(</span><span class="n">Fingerprint</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nl">includes_input_fingerprint_template</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span>

<span class="w">                </span><span class="ss">&quot;Produced Artifacts must have a &#39;{input_fingerprint}&#39; template in their Storage&quot;</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="k">update</span><span class="o">=</span><span class="err">{</span><span class="ss">&quot;storage&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">storage</span><span class="err">}</span><span class="p">)</span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>arti.graphs.TypedBox</li>
<li>arti.internal.utils.TypedBox</li>
<li>box.box.Box</li>
<li>builtins.dict</li>
<li>collections.abc.MutableMapping</li>
<li>collections.abc.Mapping</li>
<li>collections.abc.Collection</li>
<li>collections.abc.Sized</li>
<li>collections.abc.Iterable</li>
<li>collections.abc.Container</li>
</ul>
<h4 id="static-methods">Static methods</h4>
<h4 id="from_json">from_json</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span>
    <span class="n">json_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Box&#39;</span>
</code></pre></div>

<p>Transform a json object string into a Box object. If the incoming</p>
<p>json is a list, you must use BoxList.from_json.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>json_string</td>
<td>None</td>
<td>string to pass to <code>json.loads</code></td>
<td>None</td>
</tr>
<tr>
<td>filename</td>
<td>None</td>
<td>filename to open and pass to <code>json.load</code></td>
<td>None</td>
</tr>
<tr>
<td>encoding</td>
<td>None</td>
<td>File encoding</td>
<td>None</td>
</tr>
<tr>
<td>errors</td>
<td>None</td>
<td>How to handle encoding errors</td>
<td>None</td>
</tr>
<tr>
<td>kwargs</td>
<td>None</td>
<td>parameters to pass to <code>Box()</code> or <code>json.loads</code></td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>Box object from json data</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@classmethod</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_json</span><span class="p">(</span>

<span class="w">        </span><span class="n">cls</span><span class="p">,</span>

<span class="w">        </span><span class="nl">json_string</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">filename</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Union[str, PathLike</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">encoding</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;utf-8&quot;</span><span class="p">,</span>

<span class="w">        </span><span class="nl">errors</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;strict&quot;</span><span class="p">,</span>

<span class="w">        </span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">&quot;Box&quot;</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Transform a json object string into a Box object. If the incoming</span>

<span class="ss">        json is a list, you must use BoxList.from_json.</span>

<span class="ss">        :param json_string: string to pass to `json.loads`</span>

<span class="ss">        :param filename: filename to open and pass to `json.load`</span>

<span class="ss">        :param encoding: File encoding</span>

<span class="ss">        :param errors: How to handle encoding errors</span>

<span class="ss">        :param kwargs: parameters to pass to `Box()` or `json.loads`</span>

<span class="ss">        :return: Box object from json data</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">box_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span><span class="err">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">BOX_PARAMETERS</span><span class="p">:</span>

<span class="w">                </span><span class="n">box_args</span><span class="o">[</span><span class="n">arg</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

<span class="w">        </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_from_json</span><span class="p">(</span><span class="n">json_string</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;json data not returned as a dictionary, but rather a {type(data).__name__}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">box_args</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="from_msgpack">from_msgpack</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_msgpack</span><span class="p">(</span>
    <span class="n">msgpack_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Box&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="nv">@classmethod</span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">from_msgpack</span><span class="p">(</span>

<span class="w">            </span><span class="n">cls</span><span class="p">,</span>

<span class="w">            </span><span class="nl">msgpack_bytes</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">bytes</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="nl">filename</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Union[str, PathLike</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="nl">encoding</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;utf-8&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="nl">errors</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;strict&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">&quot;Box&quot;</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="s1">&#39;msgpack is unavailable on this system, please install the &quot;msgpack&quot; package&#39;</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="from_toml">from_toml</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_toml</span><span class="p">(</span>
    <span class="n">toml_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Box&#39;</span>
</code></pre></div>

<p>Transforms a toml string or file into a Box object</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>toml_string</td>
<td>None</td>
<td>string to pass to <code>toml.load</code></td>
<td>None</td>
</tr>
<tr>
<td>filename</td>
<td>None</td>
<td>filename to open and pass to <code>toml.load</code></td>
<td>None</td>
</tr>
<tr>
<td>encoding</td>
<td>None</td>
<td>File encoding</td>
<td>None</td>
</tr>
<tr>
<td>errors</td>
<td>None</td>
<td>How to handle encoding errors</td>
<td>None</td>
</tr>
<tr>
<td>kwargs</td>
<td>None</td>
<td>parameters to pass to <code>Box()</code></td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>Box object</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="nv">@classmethod</span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">from_toml</span><span class="p">(</span>

<span class="w">            </span><span class="n">cls</span><span class="p">,</span>

<span class="w">            </span><span class="nl">toml_string</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="nl">filename</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Union[str, PathLike</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="nl">encoding</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;utf-8&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="nl">errors</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;strict&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">&quot;Box&quot;</span><span class="err">:</span>

<span class="w">            </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">            Transforms a toml string or file into a Box object</span>

<span class="ss">            :param toml_string: string to pass to `toml.load`</span>

<span class="ss">            :param filename: filename to open and pass to `toml.load`</span>

<span class="ss">            :param encoding: File encoding</span>

<span class="ss">            :param errors: How to handle encoding errors</span>

<span class="ss">            :param kwargs: parameters to pass to `Box()`</span>

<span class="ss">            :return: Box object</span>

<span class="ss">            &quot;&quot;&quot;</span>

<span class="w">            </span><span class="n">box_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span><span class="err">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">BOX_PARAMETERS</span><span class="p">:</span>

<span class="w">                    </span><span class="n">box_args</span><span class="o">[</span><span class="n">arg</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

<span class="w">            </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_from_toml</span><span class="p">(</span><span class="n">toml_string</span><span class="o">=</span><span class="n">toml_string</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">box_args</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="from_yaml">from_yaml</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span>
    <span class="n">yaml_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Box&#39;</span>
</code></pre></div>

<p>Transform a yaml object string into a Box object. By default will use SafeLoader.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>yaml_string</td>
<td>None</td>
<td>string to pass to <code>yaml.load</code></td>
<td>None</td>
</tr>
<tr>
<td>filename</td>
<td>None</td>
<td>filename to open and pass to <code>yaml.load</code></td>
<td>None</td>
</tr>
<tr>
<td>encoding</td>
<td>None</td>
<td>File encoding</td>
<td>None</td>
</tr>
<tr>
<td>errors</td>
<td>None</td>
<td>How to handle encoding errors</td>
<td>None</td>
</tr>
<tr>
<td>kwargs</td>
<td>None</td>
<td>parameters to pass to <code>Box()</code> or <code>yaml.load</code></td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>Box object from yaml data</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="nv">@classmethod</span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">from_yaml</span><span class="p">(</span>

<span class="w">            </span><span class="n">cls</span><span class="p">,</span>

<span class="w">            </span><span class="nl">yaml_string</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="nl">filename</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Union[str, PathLike</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="nl">encoding</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;utf-8&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="nl">errors</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;strict&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">&quot;Box&quot;</span><span class="err">:</span>

<span class="w">            </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">            Transform a yaml object string into a Box object. By default will use SafeLoader.</span>

<span class="ss">            :param yaml_string: string to pass to `yaml.load`</span>

<span class="ss">            :param filename: filename to open and pass to `yaml.load`</span>

<span class="ss">            :param encoding: File encoding</span>

<span class="ss">            :param errors: How to handle encoding errors</span>

<span class="ss">            :param kwargs: parameters to pass to `Box()` or `yaml.load`</span>

<span class="ss">            :return: Box object from yaml data</span>

<span class="ss">            &quot;&quot;&quot;</span>

<span class="w">            </span><span class="n">box_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span><span class="err">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">BOX_PARAMETERS</span><span class="p">:</span>

<span class="w">                    </span><span class="n">box_args</span><span class="o">[</span><span class="n">arg</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

<span class="w">            </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_from_yaml</span><span class="p">(</span><span class="n">yaml_string</span><span class="o">=</span><span class="n">yaml_string</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">data</span><span class="err">:</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="n">box_args</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;yaml data not returned as a dictionary but rather a {type(data).__name__}&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">box_args</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="methods">Methods</h4>
<h4 id="clear">clear</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<p>D.clear() -&gt; None.  Remove all items from D.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">def</span><span class="w"> </span><span class="nv">clear</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span>:

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">_box_config</span>[<span class="s2">&quot;frozen_box&quot;</span>]:

<span class="w">            </span><span class="nv">raise</span><span class="w"> </span><span class="nv">BoxError</span><span class="ss">(</span><span class="s2">&quot;Box is frozen&quot;</span><span class="ss">)</span>

<span class="w">        </span><span class="nv">super</span><span class="ss">()</span>.<span class="nv">clear</span><span class="ss">()</span>

<span class="w">        </span><span class="nv">self</span>.<span class="nv">_box_config</span>[<span class="s2">&quot;__safe_keys&quot;</span>].<span class="nv">clear</span><span class="ss">()</span>
</code></pre></div>

</details>
<h4 id="copy">copy</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Box&#39;</span>
</code></pre></div>

<p>D.copy() -&gt; a shallow copy of D</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;Box&quot;</span><span class="o">:</span>

<span class="w">        </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">__box_config</span><span class="p">()</span>

<span class="w">        </span><span class="n">config</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;box_namespace&quot;</span><span class="p">)</span><span class="w">  </span><span class="p">#</span><span class="w"> </span><span class="n">Detach</span><span class="w"> </span><span class="n">namespace</span><span class="p">;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">reassigned</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">nest</span><span class="w"> </span><span class="n">again</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Box</span><span class="p">(</span><span class="n">super</span><span class="p">().</span><span class="n">copy</span><span class="p">(),</span><span class="w"> </span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="fromkeys">fromkeys</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">fromkeys</span><span class="p">(</span>
    <span class="n">iterable</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Create a new dictionary with keys from iterable and values set to value.</p>
<h4 id="get">get</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=&lt;</span><span class="nb">object</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f1a4d988080</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>

<p>Return the value for key if key is in the dictionary, else default.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="n">NO_DEFAULT</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">self</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nl">NO_DEFAULT</span><span class="p">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;default_box&quot;</span><span class="o">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;default_box_none_transform&quot;</span><span class="o">]</span><span class="err">:</span>

<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">__get_default</span><span class="p">(</span><span class="k">key</span><span class="p">)</span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span>

<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="k">None</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">Box</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Box</span><span class="p">(</span><span class="k">default</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="n">BoxList</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="n">BoxList</span><span class="p">(</span><span class="k">default</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">default</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</code></pre></div>

</details>
<h4 id="items">items</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">items</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dotted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<p>D.items() -&gt; a set-like object providing a view on D's items</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">items</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">dotted</span><span class="p">:</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">bool</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">dotted</span><span class="p">:</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">super</span><span class="p">().</span><span class="n">items</span><span class="p">()</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;box_dots&quot;</span><span class="o">]</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="ss">&quot;Cannot return dotted keys as this Box does not have `box_dots` enabled&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">(k, self[k</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">keys</span><span class="p">(</span><span class="n">dotted</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="err">]</span>
</code></pre></div>

</details>
<h4 id="keys">keys</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">keys</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dotted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<p>D.keys() -&gt; a set-like object providing a view on D's keys</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">keys</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">dotted</span><span class="o">:</span><span class="w"> </span><span class="k">Union</span><span class="err">[</span><span class="kt">bool</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">dotted</span><span class="o">:</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">super</span><span class="p">().</span><span class="k">keys</span><span class="p">()</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="err">[</span><span class="s2">&quot;box_dots&quot;</span><span class="err">]</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="s2">&quot;Cannot return dotted keys as this Box does not have `box_dots` enabled&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">set</span><span class="p">()</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="o">:</span>

<span class="w">            </span><span class="n">added</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="o">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">Box</span><span class="p">)</span><span class="o">:</span>

<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="n">sub_key</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">value</span><span class="p">.</span><span class="k">keys</span><span class="p">(</span><span class="n">dotted</span><span class="o">=</span><span class="no">True</span><span class="p">)</span><span class="o">:</span>

<span class="w">                        </span><span class="k">keys</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{key}.{sub_key}&quot;</span><span class="p">)</span>

<span class="w">                        </span><span class="n">added</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span>

<span class="w">                </span><span class="n">elif</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="n">BoxList</span><span class="p">)</span><span class="o">:</span>

<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">value</span><span class="p">.</span><span class="n">_dotted_helper</span><span class="p">()</span><span class="o">:</span>

<span class="w">                        </span><span class="k">keys</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{key}{pos}&quot;</span><span class="p">)</span>

<span class="w">                        </span><span class="n">added</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">added</span><span class="o">:</span>

<span class="w">                    </span><span class="k">keys</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="k">key</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sorted</span><span class="p">(</span><span class="k">keys</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="o">=</span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="merge_update">merge_update</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">merge_update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">merge_update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">merge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">&quot;box_merge_lists&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">kwargs</span><span class="p">:</span>

<span class="w">            </span><span class="n">merge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="ss">&quot;box_merge_lists&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">convert_and_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="n">intact_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;box_intact_types&quot;</span><span class="o">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;box_intact_types&quot;</span><span class="o">]</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">intact_type</span><span class="p">:</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">Box</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">already</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">converted</span><span class="err">`</span><span class="w"> </span><span class="n">box_config</span><span class="w"> </span><span class="k">set</span>

<span class="w">                </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;box_class&quot;</span><span class="o">]</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">self</span><span class="p">.</span><span class="n">__box_config</span><span class="p">(</span><span class="n">extra_namespace</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="err">:</span>

<span class="w">                    </span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">.</span><span class="n">merge_update</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="w">                    </span><span class="k">return</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">intact_type</span><span class="p">:</span>

<span class="w">                </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="n">BoxList</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">self</span><span class="p">.</span><span class="n">__box_config</span><span class="p">(</span><span class="n">extra_namespace</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">merge_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;extend&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="err">:</span>

<span class="w">                    </span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="w">                    </span><span class="k">return</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">merge_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;unique&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="err">:</span>

<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">v</span><span class="p">:</span>

<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="err">:</span>

<span class="w">                            </span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

<span class="w">                    </span><span class="k">return</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">bool</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxTypeError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;merge_update expected at most 1 argument, got {len(args) + int(bool(kwargs))}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">single_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">next</span><span class="p">(</span><span class="n">iter</span><span class="p">(</span><span class="n">args</span><span class="p">),</span><span class="w"> </span><span class="k">None</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">single_arg</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">single_arg</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;keys&quot;</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">single_arg</span><span class="p">:</span>

<span class="w">                    </span><span class="n">convert_and_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">single_arg</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">)</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">single_arg</span><span class="p">:</span>

<span class="w">                    </span><span class="n">convert_and_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">kwargs</span><span class="p">:</span>

<span class="w">            </span><span class="n">convert_and_set</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">kwargs</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="pop">pop</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">pop</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span>
<span class="p">)</span>
</code></pre></div>

<p>D.pop(k[,d]) -&gt; v, remove specified key and return the corresponding value.</p>
<p>If the key is not found, return the default if given; otherwise,
raise a KeyError.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">pop</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;frozen_box&quot;</span><span class="o">]</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="ss">&quot;Box is frozen&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">args</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="s1">&#39;pop() takes only one optional argument &quot;default&quot;&#39;</span><span class="p">)</span>

<span class="w">            </span><span class="k">try</span><span class="err">:</span>

<span class="w">                </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>

<span class="w">            </span><span class="ow">except</span><span class="w"> </span><span class="nl">KeyError</span><span class="p">:</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">args</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">del</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">item</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">KeyError</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxKeyError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;{key}&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span>

<span class="w">            </span><span class="n">del</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">item</span>
</code></pre></div>

</details>
<h4 id="popitem">popitem</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<p>Remove and return a (key, value) pair as a 2-tuple.</p>
<p>Pairs are returned in LIFO (last-in, first-out) order.
Raises KeyError if the dict is empty.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">def</span><span class="w"> </span><span class="nv">popitem</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span>:

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">_box_config</span>[<span class="s2">&quot;frozen_box&quot;</span>]:

<span class="w">            </span><span class="nv">raise</span><span class="w"> </span><span class="nv">BoxError</span><span class="ss">(</span><span class="s2">&quot;Box is frozen&quot;</span><span class="ss">)</span>

<span class="w">        </span><span class="nv">try</span>:

<span class="w">            </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">next</span><span class="ss">(</span><span class="nv">self</span>.<span class="nv">__iter__</span><span class="ss">())</span>

<span class="w">        </span><span class="nv">except</span><span class="w"> </span><span class="nv">StopIteration</span>:

<span class="w">            </span><span class="nv">raise</span><span class="w"> </span><span class="nv">BoxKeyError</span><span class="ss">(</span><span class="s2">&quot;Empty box&quot;</span><span class="ss">)</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">None</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">key</span>,<span class="w"> </span><span class="nv">self</span>.<span class="nv">pop</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span>
</code></pre></div>

</details>
<h4 id="setdefault">setdefault</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">item</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Insert key with a value of default if key is not in the dictionary.</p>
<p>Return the value for key if key is in the dictionary, else default.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">setdefault</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">self</span><span class="p">:</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">item</span><span class="o">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;box_dots&quot;</span><span class="o">]</span><span class="err">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">_get_dot_paths</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">item</span><span class="o">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="k">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;box_class&quot;</span><span class="o">]</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">self</span><span class="p">.</span><span class="n">__box_config</span><span class="p">(</span><span class="n">extra_namespace</span><span class="o">=</span><span class="n">item</span><span class="p">))</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="k">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="n">BoxList</span><span class="p">(</span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">self</span><span class="p">.</span><span class="n">__box_config</span><span class="p">(</span><span class="n">extra_namespace</span><span class="o">=</span><span class="n">item</span><span class="p">))</span>

<span class="w">        </span><span class="n">self</span><span class="o">[</span><span class="n">item</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="o">[</span><span class="n">item</span><span class="o">]</span>
</code></pre></div>

</details>
<h4 id="to_dict">to_dict</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span>
</code></pre></div>

<p>Turn the Box and sub Boxes back into a native python dictionary.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>python dictionary of this Box</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">to_dict</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">Dict</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Turn the Box and sub Boxes back into a native python dictionary.</span>

<span class="ss">        :return: python dictionary of this Box</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">out_dict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">out_dict</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nl">self</span><span class="p">:</span>

<span class="w">                </span><span class="n">out_dict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out_dict</span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">Box</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="n">out_dict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">to_dict</span><span class="p">()</span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="n">BoxList</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="n">out_dict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out_dict</span>
</code></pre></div>

</details>
<h4 id="to_json">to_json</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">json_kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Transform the Box object into a JSON string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>None</td>
<td>If provided will save to file</td>
<td>None</td>
</tr>
<tr>
<td>encoding</td>
<td>None</td>
<td>File encoding</td>
<td>None</td>
</tr>
<tr>
<td>errors</td>
<td>None</td>
<td>How to handle encoding errors</td>
<td>None</td>
</tr>
<tr>
<td>json_kwargs</td>
<td>None</td>
<td>additional arguments to pass to json.dump(s)</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>string of JSON (if no filename provided)</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">def</span><span class="w"> </span><span class="nv">to_json</span><span class="ss">(</span>

<span class="w">        </span><span class="nv">self</span>,

<span class="w">        </span><span class="nv">filename</span>:<span class="w"> </span><span class="nv">Optional</span>[<span class="nv">Union</span>[<span class="nv">str</span>,<span class="w"> </span><span class="nv">PathLike</span>]]<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>,

<span class="w">        </span><span class="nv">encoding</span>:<span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;utf-8&quot;</span>,

<span class="w">        </span><span class="nv">errors</span>:<span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;strict&quot;</span>,

<span class="w">        </span><span class="o">**</span><span class="nv">json_kwargs</span>,

<span class="w">    </span><span class="ss">)</span>:

<span class="w">        </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">        Transform the Box object into a JSON string.</span>

<span class="err">        :param filename: If provided will save to file</span>

<span class="err">        :param encoding: File encoding</span>

<span class="err">        :param errors: How to handle encoding errors</span>

<span class="err">        :param json_kwargs: additional arguments to pass to json.dump(s)</span>

<span class="err">        :return: string of JSON (if no filename provided)</span>

<span class="w">        </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">        return _to_json(self.to_dict(), filename=filename, encoding=encoding, errors=errors, **json_kwargs)</span>
</code></pre></div>

</details>
<h4 id="to_msgpack">to_msgpack</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_msgpack</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code>        def to_msgpack(self, filename: Optional[Union[str, PathLike]] = None, **kwargs):

            raise BoxError(&#39;msgpack is unavailable on this system, please install the &quot;msgpack&quot; package&#39;)
</code></pre></div>

</details>
<h4 id="to_toml">to_toml</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_toml</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span>
<span class="p">)</span>
</code></pre></div>

<p>Transform the Box object into a toml string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>None</td>
<td>File to write toml object too</td>
<td>None</td>
</tr>
<tr>
<td>encoding</td>
<td>None</td>
<td>File encoding</td>
<td>None</td>
</tr>
<tr>
<td>errors</td>
<td>None</td>
<td>How to handle encoding errors</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>string of TOML (if no filename provided)</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="nv">def</span><span class="w"> </span><span class="nv">to_toml</span><span class="ss">(</span>

<span class="w">            </span><span class="nv">self</span>,<span class="w"> </span><span class="nv">filename</span>:<span class="w"> </span><span class="nv">Optional</span>[<span class="nv">Union</span>[<span class="nv">str</span>,<span class="w"> </span><span class="nv">PathLike</span>]]<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>,<span class="w"> </span><span class="nv">encoding</span>:<span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;utf-8&quot;</span>,<span class="w"> </span><span class="nv">errors</span>:<span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;strict&quot;</span>

<span class="w">        </span><span class="ss">)</span>:

<span class="w">            </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">            Transform the Box object into a toml string.</span>

<span class="err">            :param filename: File to write toml object too</span>

<span class="err">            :param encoding: File encoding</span>

<span class="err">            :param errors: How to handle encoding errors</span>

<span class="err">            :return: string of TOML (if no filename provided)</span>

<span class="w">            </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">            return _to_toml(self.to_dict(), filename=filename, encoding=encoding, errors=errors)</span>
</code></pre></div>

</details>
<h4 id="to_yaml">to_yaml</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_yaml</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_flow_style</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">yaml_kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Transform the Box object into a YAML string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>None</td>
<td>If provided will save to file</td>
<td>None</td>
</tr>
<tr>
<td>default_flow_style</td>
<td>None</td>
<td>False will recursively dump dicts</td>
<td>None</td>
</tr>
<tr>
<td>encoding</td>
<td>None</td>
<td>File encoding</td>
<td>None</td>
</tr>
<tr>
<td>errors</td>
<td>None</td>
<td>How to handle encoding errors</td>
<td>None</td>
</tr>
<tr>
<td>yaml_kwargs</td>
<td>None</td>
<td>additional arguments to pass to yaml.dump</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>string of YAML (if no filename provided)</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="nv">def</span><span class="w"> </span><span class="nv">to_yaml</span><span class="ss">(</span>

<span class="w">            </span><span class="nv">self</span>,

<span class="w">            </span><span class="nv">filename</span>:<span class="w"> </span><span class="nv">Optional</span>[<span class="nv">Union</span>[<span class="nv">str</span>,<span class="w"> </span><span class="nv">PathLike</span>]]<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>,

<span class="w">            </span><span class="nv">default_flow_style</span>:<span class="w"> </span><span class="nv">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">False</span>,

<span class="w">            </span><span class="nv">encoding</span>:<span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;utf-8&quot;</span>,

<span class="w">            </span><span class="nv">errors</span>:<span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;strict&quot;</span>,

<span class="w">            </span><span class="o">**</span><span class="nv">yaml_kwargs</span>,

<span class="w">        </span><span class="ss">)</span>:

<span class="w">            </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">            Transform the Box object into a YAML string.</span>

<span class="err">            :param filename:  If provided will save to file</span>

<span class="err">            :param default_flow_style: False will recursively dump dicts</span>

<span class="err">            :param encoding: File encoding</span>

<span class="err">            :param errors: How to handle encoding errors</span>

<span class="err">            :param yaml_kwargs: additional arguments to pass to yaml.dump</span>

<span class="err">            :return: string of YAML (if no filename provided)</span>

<span class="w">            </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">            return _to_yaml(</span>

<span class="err">                self.to_dict(),</span>

<span class="err">                filename=filename,</span>

<span class="err">                default_flow_style=default_flow_style,</span>

<span class="err">                encoding=encoding,</span>

<span class="err">                errors=errors,</span>

<span class="err">                **yaml_kwargs,</span>

<span class="err">            )</span>
</code></pre></div>

</details>
<h4 id="update">update</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>D.update([E, ]**F) -&gt; None.  Update D from dict/iterable E and F.</p>
<p>If E is present and has a .keys() method, then does:  for k in E: D[k] = E[k]
If E is present and lacks a .keys() method, then does:  for k, v in E: D[k] = v
In either case, this is followed by: for k in F:  D[k] = F[k]</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_box_config</span><span class="o">[</span><span class="n">&quot;frozen_box&quot;</span><span class="o">]</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxError</span><span class="p">(</span><span class="ss">&quot;Box is frozen&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">bool</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">BoxTypeError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;update expected at most 1 argument, got {len(args) + int(bool(kwargs))}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">single_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">next</span><span class="p">(</span><span class="n">iter</span><span class="p">(</span><span class="n">args</span><span class="p">),</span><span class="w"> </span><span class="k">None</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">single_arg</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">single_arg</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;keys&quot;</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">single_arg</span><span class="p">:</span>

<span class="w">                    </span><span class="n">self</span><span class="p">.</span><span class="n">__convert_and_store</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">single_arg</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">)</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">single_arg</span><span class="p">:</span>

<span class="w">                    </span><span class="n">self</span><span class="p">.</span><span class="n">__convert_and_store</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">kwargs</span><span class="p">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">__convert_and_store</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">kwargs</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="values">values</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">values</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.values() -&gt; an object providing a view on D's values</p>
<h4 id="walk">walk</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">walk</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">root</span><span class="p">:</span> <span class="s1">&#39;tuple[str, ...]&#39;</span> <span class="o">=</span> <span class="p">()</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Iterator[tuple[str, _V]]&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">walk</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">root</span><span class="p">:</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">str, ...</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Iterator</span><span class="o">[</span><span class="n">tuple[str, _V</span><span class="o">]</span><span class="err">]:</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span>

<span class="w">            </span><span class="n">subroot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">TypedBox</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="n">yield</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">subroot</span><span class="p">)</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">yield</span><span class="w"> </span><span class="ss">&quot;.&quot;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="n">subroot</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="k">ignore</span><span class="o">[</span><span class="n">misc</span><span class="o">]</span>
</code></pre></div>

</details>
<h3 id="graph">Graph</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Graph</span><span class="p">(</span>
    <span class="n">__pydantic_self__</span><span class="p">,</span>
    <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">Graph</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="err">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Graph stores a web of Artifacts connected by Producers.&quot;&quot;&quot;</span>

<span class="w">    </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span>

<span class="w">    </span><span class="nl">artifacts</span><span class="p">:</span><span class="w"> </span><span class="n">ArtifactBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nl">lambda</span><span class="p">:</span><span class="w"> </span><span class="n">ArtifactBox</span><span class="p">(</span><span class="o">**</span><span class="n">BOX_KWARGS</span><span class="o">[</span><span class="n">SEALED</span><span class="o">]</span><span class="p">))</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Backend</span><span class="w"> </span><span class="o">*</span><span class="n">itself</span><span class="o">*</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">affect</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="n">build</span><span class="p">,</span><span class="w"> </span><span class="n">though</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">contents</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">certainly</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="p">(</span><span class="nl">eg</span><span class="p">:</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">annotations</span><span class="p">),</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">serializing</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">prevent</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">embedding</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">credentials</span><span class="p">.</span>

<span class="w">    </span><span class="nl">backend</span><span class="p">:</span><span class="w"> </span><span class="n">Backend</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">_get_memory_backend</span><span class="p">,</span><span class="w"> </span><span class="n">exclude</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

<span class="w">    </span><span class="nl">path_tags</span><span class="p">:</span><span class="w"> </span><span class="n">frozendict</span><span class="o">[</span><span class="n">str, str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frozendict</span><span class="p">()</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="k">off</span><span class="w"> </span><span class="n">sealed</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="k">with</span><span class="w"> </span><span class="n">Graph</span><span class="p">(...)</span><span class="err">`</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="nl">_status</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">bool</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PrivateAttr</span><span class="p">(</span><span class="k">None</span><span class="p">)</span>

<span class="w">    </span><span class="nl">_artifact_to_key</span><span class="p">:</span><span class="w"> </span><span class="n">frozendict</span><span class="o">[</span><span class="n">Artifact, str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PrivateAttr</span><span class="p">(</span><span class="n">frozendict</span><span class="p">())</span>

<span class="w">    </span><span class="nv">@validator</span><span class="p">(</span><span class="ss">&quot;artifacts&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@classmethod</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_convert_artifacts</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="nl">artifacts</span><span class="p">:</span><span class="w"> </span><span class="n">ArtifactBox</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">ArtifactBox</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ArtifactBox</span><span class="p">(</span><span class="n">artifacts</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">BOX_KWARGS</span><span class="o">[</span><span class="n">SEALED</span><span class="o">]</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__enter__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">Graph</span><span class="p">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">arti</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">graph</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Another graph is being defined: {arti.context.graph}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">arti</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_toggle</span><span class="p">(</span><span class="k">OPEN</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__exit__</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">exc_type</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">type[BaseException</span><span class="o">]</span><span class="err">]</span><span class="p">,</span>

<span class="w">        </span><span class="nl">exc_value</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">BaseException</span><span class="o">]</span><span class="p">,</span>

<span class="w">        </span><span class="nl">exc_traceback</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">TracebackType</span><span class="o">]</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="n">arti</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_toggle</span><span class="p">(</span><span class="n">SEALED</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Confirm</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dependencies</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">acyclic</span>

<span class="w">        </span><span class="n">TopologicalSorter</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">dependencies</span><span class="p">).</span><span class="k">prepare</span><span class="p">()</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_toggle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">status</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ss">&quot;frozen&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">bypass</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">checks</span><span class="p">.</span>

<span class="w">        </span><span class="k">object</span><span class="p">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;artifacts&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ArtifactBox</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">artifacts</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">BOX_KWARGS</span><span class="o">[</span><span class="n">status</span><span class="o">]</span><span class="p">))</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_artifact_to_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frozendict</span><span class="p">(</span>

<span class="w">            </span><span class="err">{</span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">artifact</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">artifacts</span><span class="p">.</span><span class="n">walk</span><span class="p">()</span><span class="err">}</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="nv">@property</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">artifact_to_key</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">frozendict</span><span class="o">[</span><span class="n">Artifact, str</span><span class="o">]</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_artifact_to_key</span>

<span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">executor</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Executor</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">snapshot</span><span class="p">().</span><span class="n">build</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Identify a &quot;</span><span class="k">unique</span><span class="ss">&quot; ID for this Graph at this point in time.</span>

<span class="ss">        The ID aims to encode the structure of the Graph plus a _snapshot_ of the raw Artifact data</span>

<span class="ss">        (partition kinds and contents). Any change that would affect data should prompt an ID</span>

<span class="ss">        change, however changes to this ID don&#39;t directly cause data to be reproduced.</span>

<span class="ss">        NOTE: There is currently a gap (and thus race condition) between when the Graph ID is</span>

<span class="ss">        computed and when we read raw Artifacts data during Producer builds.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GraphSnapshot</span><span class="p">.</span><span class="n">from_graph</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="o">=</span><span class="k">connection</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@cached_property</span>

<span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">dependencies</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">NodeDependencies</span><span class="p">:</span>

<span class="w">        </span><span class="n">artifact_deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="p">(</span>

<span class="w">                </span><span class="n">frozenset</span><span class="p">(</span><span class="err">{</span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="p">.</span><span class="n">producer</span><span class="err">}</span><span class="p">)</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span>

<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="n">frozenset</span><span class="p">()</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">artifact</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">artifacts</span><span class="p">.</span><span class="n">walk</span><span class="p">()</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="n">producer_deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nl">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">multi</span><span class="o">-</span><span class="k">output</span><span class="w"> </span><span class="n">Producers</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="p">(</span><span class="n">but</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">deduped</span><span class="p">)</span>

<span class="w">            </span><span class="n">producer_output</span><span class="p">.</span><span class="nl">producer</span><span class="p">:</span><span class="w"> </span><span class="n">frozenset</span><span class="p">(</span><span class="n">producer_output</span><span class="p">.</span><span class="n">producer</span><span class="p">.</span><span class="n">inputs</span><span class="p">.</span><span class="k">values</span><span class="p">())</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">artifact</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">artifact_deps</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">producer_output</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NodeDependencies</span><span class="p">(</span><span class="n">artifact_deps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">producer_deps</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@cached_property</span>

<span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">producers</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">frozenset</span><span class="o">[</span><span class="n">Producer</span><span class="o">]</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">frozenset</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">producer_outputs</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@cached_property</span>

<span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">producer_outputs</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">frozendict</span><span class="o">[</span><span class="n">Producer, tuple[Artifact, ...</span><span class="o">]</span><span class="err">]:</span>

<span class="w">        </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultdict</span><span class="o">[</span><span class="n">Producer, dict[int, Artifact</span><span class="o">]</span><span class="err">]</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">artifact</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">artifacts</span><span class="p">.</span><span class="n">walk</span><span class="p">()</span><span class="err">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="k">continue</span>

<span class="w">            </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span>

<span class="w">            </span><span class="n">d</span><span class="o">[</span><span class="n">output.producer</span><span class="o">][</span><span class="n">output.position</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artifact</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">frozendict</span><span class="p">(</span>

<span class="w">            </span><span class="p">(</span><span class="n">producer</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">(</span><span class="n">artifacts_by_position</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sorted</span><span class="p">(</span><span class="n">artifacts_by_position</span><span class="p">)))</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">producer</span><span class="p">,</span><span class="w"> </span><span class="n">artifacts_by_position</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">items</span><span class="p">()</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nl">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="k">read</span><span class="o">/</span><span class="k">write</span><span class="w"> </span><span class="n">probably</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">sanity</span><span class="w"> </span><span class="n">checking</span><span class="w"> </span><span class="p">(</span><span class="n">probably</span><span class="w"> </span><span class="n">somewhere</span><span class="w"> </span><span class="k">else</span><span class="p">),</span><span class="w"> </span><span class="nl">eg</span><span class="p">:</span><span class="w"> </span><span class="n">type</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="k">view</span><span class="p">.</span><span class="w"> </span><span class="n">Doing</span><span class="w"> </span><span class="n">validation</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">.</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">View</span><span class="vm">?</span>

<span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">read</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="p">,</span>

<span class="w">        </span><span class="o">*</span><span class="p">,</span>

<span class="w">        </span><span class="nl">annotation</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Any</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">storage_partitions</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Sequence[StoragePartition</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">view</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">View</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">snapshot</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">GraphSnapshot</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">Any</span><span class="err">:</span>

<span class="w">        </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">artifact_to_key</span><span class="o">[</span><span class="n">artifact</span><span class="o">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">annotation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="ss">&quot;Either `annotation` or `view` must be passed&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">annotation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="ss">&quot;Only one of `annotation` or `view` may be passed&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">annotation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="k">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">get_class_for</span><span class="p">(</span><span class="n">annotation</span><span class="p">)(</span>

<span class="w">                </span><span class="n">artifact_class</span><span class="o">=</span><span class="n">type</span><span class="p">(</span><span class="n">artifact</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">artifact</span><span class="p">.</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="ss">&quot;READ&quot;</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="k">view</span><span class="p">.</span><span class="n">check_annotation_compatibility</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>

<span class="w">            </span><span class="k">view</span><span class="p">.</span><span class="n">check_artifact_compatibility</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>

<span class="w">        </span><span class="n">assert</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">mypy</span><span class="w"> </span><span class="n">gets</span><span class="w"> </span><span class="n">mixed</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="o">^</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">storage_partitions</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">missing</span><span class="w"> </span><span class="p">(</span><span class="n">which</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">prevents</span><span class="w"> </span><span class="n">snapshotting</span><span class="p">).</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="nl">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">We</span><span class="s1">&#39;re not using read_artifact_partitions as the underlying data may have</span>

<span class="s1">                # changed. The backend may have pointers to old versions (which is expected), but we</span>

<span class="s1">                # only want to return the current values.</span>

<span class="s1">                storage_partitions = artifact.storage.discover_partitions()</span>

<span class="s1">            else:</span>

<span class="s1">                snapshot = snapshot or self.snapshot()</span>

<span class="s1">                with (connection or self.backend).connect() as conn:</span>

<span class="s1">                    storage_partitions = conn.read_snapshot_partitions(snapshot, key, artifact)</span>

<span class="s1">        return io.read(</span>

<span class="s1">            type_=artifact.type,</span>

<span class="s1">            format=artifact.format,</span>

<span class="s1">            storage_partitions=storage_partitions,</span>

<span class="s1">            view=view,</span>

<span class="s1">        )</span>

<span class="s1">    @requires_sealed</span>

<span class="s1">    def write(</span>

<span class="s1">        self,</span>

<span class="s1">        data: Any,</span>

<span class="s1">        *,</span>

<span class="s1">        artifact: Artifact,</span>

<span class="s1">        input_fingerprint: Fingerprint = Fingerprint.empty(),</span>

<span class="s1">        keys: CompositeKey = CompositeKey(),</span>

<span class="s1">        view: Optional[View] = None,</span>

<span class="s1">        snapshot: Optional[GraphSnapshot] = None,</span>

<span class="s1">        connection: Optional[Connection] = None,</span>

<span class="s1">    ) -&gt; StoragePartition:</span>

<span class="s1">        key = self.artifact_to_key[artifact]</span>

<span class="s1">        if snapshot is not None and artifact.producer_output is None:</span>

<span class="s1">            raise ValueError(</span>

<span class="s1">                f&quot;Writing to a raw Artifact (`{key}`) with a GraphSnapshot is not supported.&quot;</span>

<span class="s1">            )</span>

<span class="s1">        if view is None:</span>

<span class="s1">            view = View.get_class_for(type(data))(</span>

<span class="s1">                artifact_class=type(artifact), type=artifact.type, mode=&quot;WRITE&quot;</span>

<span class="s1">            )</span>

<span class="s1">        view.check_annotation_compatibility(type(data))</span>

<span class="s1">        view.check_artifact_compatibility(artifact)</span>

<span class="s1">        storage_partition = artifact.storage.generate_partition(</span>

<span class="s1">            input_fingerprint=input_fingerprint, keys=keys, with_content_fingerprint=False</span>

<span class="s1">        )</span>

<span class="s1">        storage_partition = io.write(</span>

<span class="s1">            data,</span>

<span class="s1">            type_=artifact.type,</span>

<span class="s1">            format=artifact.format,</span>

<span class="s1">            storage_partition=storage_partition,</span>

<span class="s1">            view=view,</span>

<span class="s1">        ).with_content_fingerprint()</span>

<span class="s1">        # TODO: Should we only do this in bulk? We might want the backends to transparently batch</span>

<span class="s1">        # requests, but that&#39;</span><span class="n">s</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">friendly</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">transient</span><span class="w"> </span><span class="ss">&quot;.connect&quot;</span><span class="p">.</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="k">connection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">backend</span><span class="p">).</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_artifact_partitions</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">storage_partition</span><span class="p">,))</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Skip</span><span class="w"> </span><span class="n">linking</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">partition</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">affects</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="p">(</span><span class="n">which</span><span class="w"> </span><span class="n">would</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">trigger</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">change</span><span class="p">).</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">conn</span><span class="p">.</span><span class="n">write_snapshot_partitions</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">artifact</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">storage_partition</span><span class="p">,))</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">storage_partition</span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro_1">Ancestors (in MRO)</h4>
<ul>
<li>arti.internal.models.Model</li>
<li>pydantic.main.BaseModel</li>
<li>pydantic.utils.Representation</li>
</ul>
<h4 id="class-variables">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">Config</span>
</code></pre></div>

<h4 id="static-methods_1">Static methods</h4>
<h4 id="construct">construct</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">construct</span><span class="p">(</span>
    <span class="n">_fields_set</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;SetStr&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">values</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<p>Creates a new model setting <strong>dict</strong> and <strong>fields_set</strong> from trusted or pre-validated data.</p>
<p>Default values are respected, but no other validation is performed.
Behaves as if <code>Config.extra = 'allow'</code> was set since it adds all passed values</p>
<h4 id="from_orm">from_orm</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_orm</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="parse_file">parse_file</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
    <span class="n">proto</span><span class="p">:</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">Protocol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allow_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="parse_obj">parse_obj</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_obj</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="parse_raw">parse_raw</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_raw</span><span class="p">(</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
    <span class="n">proto</span><span class="p">:</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">Protocol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allow_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="schema">schema</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">schema</span><span class="p">(</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ref_template</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;#/definitions/</span><span class="si">{model}</span><span class="s1">&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;DictStrAny&#39;</span>
</code></pre></div>

<h4 id="schema_json">schema_json</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">schema_json</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ref_template</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;#/definitions/</span><span class="si">{model}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">dumps_kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;unicode&#39;</span>
</code></pre></div>

<h4 id="update_forward_refs">update_forward_refs</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">update_forward_refs</span><span class="p">(</span>
    <span class="o">**</span><span class="n">localns</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>Try to update ForwardRefs on fields based on this Model, globalns and localns.</p>
<h4 id="validate">validate</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">artifact_to_key</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fingerprint</span>
</code></pre></div>

<h4 id="methods_1">Methods</h4>
<h4 id="build">build</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">build</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">executor</span><span class="p">:</span> <span class="s1">&#39;Optional[Executor]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GraphSnapshot&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">executor</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Executor</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">snapshot</span><span class="p">().</span><span class="n">build</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="copy_1">copy</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">deep</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">validate</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="s1">&#39;Any&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Self&#39;</span>
</code></pre></div>

<p>Duplicate a model, optionally choose which fields to include, exclude and change.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>include</td>
<td>None</td>
<td>fields to include in new model</td>
<td>None</td>
</tr>
<tr>
<td>exclude</td>
<td>None</td>
<td>fields to exclude from new model, as with values this takes precedence over include</td>
<td>None</td>
</tr>
<tr>
<td>update</td>
<td>None</td>
<td>values to change/add in the new model. Note: the data is not validated before creating</td>
<td></td>
</tr>
<tr>
<td>the new model: you should trust this data</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>deep</td>
<td>None</td>
<td>set to <code>True</code> to make a deep copy of the model</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>new model instance</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">deep</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span><span class="p">,</span><span class="w"> </span><span class="n">validate</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="o">:</span><span class="w"> </span><span class="k">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Self</span><span class="o">:</span>

<span class="w">        </span><span class="n">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">super</span><span class="p">().</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">validate</span><span class="o">:</span>

<span class="w">            </span><span class="c1"># NOTE: We set exclude_unset=False so that all existing defaulted fields are reused (as</span>

<span class="w">            </span><span class="c1"># is normal `.copy` behavior).</span>

<span class="w">            </span><span class="c1">#</span>

<span class="w">            </span><span class="c1"># To reduce `repr` noise, we&#39;ll reset .__fields_set__ to those of the pre-validation copy</span>

<span class="w">            </span><span class="c1"># (which includes those originally set + updated).</span>

<span class="w">            </span><span class="n">fields_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">.</span><span class="n">__fields_set__</span>

<span class="w">            </span><span class="n">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span>

<span class="w">                </span><span class="n">dict</span><span class="p">(</span><span class="n">copy</span><span class="p">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">to_dict</span><span class="o">=</span><span class="no">False</span><span class="p">,</span><span class="w"> </span><span class="n">by_alias</span><span class="o">=</span><span class="no">False</span><span class="p">,</span><span class="w"> </span><span class="n">exclude_unset</span><span class="o">=</span><span class="no">False</span><span class="p">))</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="c1"># Use object.__setattr__ to bypass frozen model assignment errors</span>

<span class="w">            </span><span class="n">object</span><span class="p">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;__fields_set__&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">set</span><span class="p">(</span><span class="n">fields_set</span><span class="p">))</span>

<span class="w">            </span><span class="c1"># Copy over the private attributes, which are missing after validation (since we&#39;re only</span>

<span class="w">            </span><span class="c1"># passing the fields).</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">__private_attributes__</span><span class="o">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">getattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="k">Undefined</span><span class="p">))</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">Undefined</span><span class="o">:</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">deep</span><span class="o">:</span>

<span class="w">                        </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deepcopy</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>

<span class="w">                    </span><span class="n">object</span><span class="p">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">copy</span>
</code></pre></div>

</details>
<h4 id="dependencies">dependencies</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">dependencies</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="dict">dict</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">dict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">include</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">skip_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;DictStrAny&#39;</span>
</code></pre></div>

<p>Generate a dictionary representation of the model, optionally specifying which fields to include or exclude.</p>
<h4 id="json">json</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">json</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">include</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">skip_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">encoder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">models_as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">dumps_kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;unicode&#39;</span>
</code></pre></div>

<p>Generate a JSON representation of the model, <code>include</code> and <code>exclude</code> arguments as per <code>dict()</code>.</p>
<p><code>encoder</code> is an optional function to supply as <code>default</code> to json.dumps(), other arguments as per <code>json.dumps()</code>.</p>
<h4 id="producer_outputs">producer_outputs</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">producer_outputs</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="producers">producers</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">producers</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="read">read</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">artifact</span><span class="p">:</span> <span class="s1">&#39;Artifact&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">annotation</span><span class="p">:</span> <span class="s1">&#39;Optional[Any]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_partitions</span><span class="p">:</span> <span class="s1">&#39;Optional[Sequence[StoragePartition]]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">view</span><span class="p">:</span> <span class="s1">&#39;Optional[View]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">snapshot</span><span class="p">:</span> <span class="s1">&#39;Optional[GraphSnapshot]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">connection</span><span class="p">:</span> <span class="s1">&#39;Optional[Connection]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Any&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">read</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="p">,</span>

<span class="w">        </span><span class="o">*</span><span class="p">,</span>

<span class="w">        </span><span class="nl">annotation</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Any</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">storage_partitions</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Sequence[StoragePartition</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">view</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">View</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">snapshot</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">GraphSnapshot</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">Any</span><span class="err">:</span>

<span class="w">        </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">artifact_to_key</span><span class="o">[</span><span class="n">artifact</span><span class="o">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">annotation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="ss">&quot;Either `annotation` or `view` must be passed&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">annotation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="ss">&quot;Only one of `annotation` or `view` may be passed&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">annotation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="k">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">get_class_for</span><span class="p">(</span><span class="n">annotation</span><span class="p">)(</span>

<span class="w">                </span><span class="n">artifact_class</span><span class="o">=</span><span class="n">type</span><span class="p">(</span><span class="n">artifact</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">artifact</span><span class="p">.</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="ss">&quot;READ&quot;</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="k">view</span><span class="p">.</span><span class="n">check_annotation_compatibility</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>

<span class="w">            </span><span class="k">view</span><span class="p">.</span><span class="n">check_artifact_compatibility</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>

<span class="w">        </span><span class="n">assert</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">mypy</span><span class="w"> </span><span class="n">gets</span><span class="w"> </span><span class="n">mixed</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="o">^</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">storage_partitions</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">missing</span><span class="w"> </span><span class="p">(</span><span class="n">which</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">prevents</span><span class="w"> </span><span class="n">snapshotting</span><span class="p">).</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="nl">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">We</span><span class="err">&#39;</span><span class="n">re</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">read_artifact_partitions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">underlying</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">have</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">changed</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">backend</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">pointers</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">old</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="p">(</span><span class="n">which</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">expected</span><span class="p">),</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">we</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">values</span><span class="p">.</span>

<span class="w">                </span><span class="n">storage_partitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">discover_partitions</span><span class="p">()</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">snapshot</span><span class="p">()</span>

<span class="w">                </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="k">connection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">backend</span><span class="p">).</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">                    </span><span class="n">storage_partitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="n">read_snapshot_partitions</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">artifact</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="k">read</span><span class="p">(</span>

<span class="w">            </span><span class="n">type_</span><span class="o">=</span><span class="n">artifact</span><span class="p">.</span><span class="n">type</span><span class="p">,</span>

<span class="w">            </span><span class="nf">format</span><span class="o">=</span><span class="n">artifact</span><span class="p">.</span><span class="nf">format</span><span class="p">,</span>

<span class="w">            </span><span class="n">storage_partitions</span><span class="o">=</span><span class="n">storage_partitions</span><span class="p">,</span>

<span class="w">            </span><span class="k">view</span><span class="o">=</span><span class="k">view</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="snapshot">snapshot</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">connection</span><span class="p">:</span> <span class="s1">&#39;Optional[Connection]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GraphSnapshot&#39;</span>
</code></pre></div>

<p>Identify a "unique" ID for this Graph at this point in time.</p>
<p>The ID aims to encode the structure of the Graph plus a <em>snapshot</em> of the raw Artifact data
(partition kinds and contents). Any change that would affect data should prompt an ID
change, however changes to this ID don't directly cause data to be reproduced.</p>
<p>NOTE: There is currently a gap (and thus race condition) between when the Graph ID is
computed and when we read raw Artifacts data during Producer builds.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Identify a &quot;</span><span class="k">unique</span><span class="ss">&quot; ID for this Graph at this point in time.</span>

<span class="ss">        The ID aims to encode the structure of the Graph plus a _snapshot_ of the raw Artifact data</span>

<span class="ss">        (partition kinds and contents). Any change that would affect data should prompt an ID</span>

<span class="ss">        change, however changes to this ID don&#39;t directly cause data to be reproduced.</span>

<span class="ss">        NOTE: There is currently a gap (and thus race condition) between when the Graph ID is</span>

<span class="ss">        computed and when we read raw Artifacts data during Producer builds.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GraphSnapshot</span><span class="p">.</span><span class="n">from_graph</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="o">=</span><span class="k">connection</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="write">write</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="s1">&#39;Any&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">artifact</span><span class="p">:</span> <span class="s1">&#39;Artifact&#39;</span><span class="p">,</span>
    <span class="n">input_fingerprint</span><span class="p">:</span> <span class="s1">&#39;Fingerprint&#39;</span> <span class="o">=</span> <span class="n">Fingerprint</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">keys</span><span class="p">:</span> <span class="s1">&#39;CompositeKey&#39;</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">view</span><span class="p">:</span> <span class="s1">&#39;Optional[View]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">snapshot</span><span class="p">:</span> <span class="s1">&#39;Optional[GraphSnapshot]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">connection</span><span class="p">:</span> <span class="s1">&#39;Optional[Connection]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;StoragePartition&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@requires_sealed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">write</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="ow">Any</span><span class="p">,</span>

<span class="w">        </span><span class="o">*</span><span class="p">,</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="p">,</span>

<span class="w">        </span><span class="nl">input_fingerprint</span><span class="p">:</span><span class="w"> </span><span class="n">Fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fingerprint</span><span class="p">.</span><span class="n">empty</span><span class="p">(),</span>

<span class="w">        </span><span class="nl">keys</span><span class="p">:</span><span class="w"> </span><span class="n">CompositeKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompositeKey</span><span class="p">(),</span>

<span class="w">        </span><span class="k">view</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">View</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">snapshot</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">GraphSnapshot</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">StoragePartition</span><span class="p">:</span>

<span class="w">        </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">artifact_to_key</span><span class="o">[</span><span class="n">artifact</span><span class="o">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span>

<span class="w">                </span><span class="n">f</span><span class="ss">&quot;Writing to a raw Artifact (`{key}`) with a GraphSnapshot is not supported.&quot;</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="k">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">get_class_for</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="k">data</span><span class="p">))(</span>

<span class="w">                </span><span class="n">artifact_class</span><span class="o">=</span><span class="n">type</span><span class="p">(</span><span class="n">artifact</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">artifact</span><span class="p">.</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="ss">&quot;WRITE&quot;</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="k">view</span><span class="p">.</span><span class="n">check_annotation_compatibility</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="k">data</span><span class="p">))</span>

<span class="w">        </span><span class="k">view</span><span class="p">.</span><span class="n">check_artifact_compatibility</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>

<span class="w">        </span><span class="n">storage_partition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">generate_partition</span><span class="p">(</span>

<span class="w">            </span><span class="n">input_fingerprint</span><span class="o">=</span><span class="n">input_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span><span class="w"> </span><span class="n">with_content_fingerprint</span><span class="o">=</span><span class="k">False</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">storage_partition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="k">write</span><span class="p">(</span>

<span class="w">            </span><span class="k">data</span><span class="p">,</span>

<span class="w">            </span><span class="n">type_</span><span class="o">=</span><span class="n">artifact</span><span class="p">.</span><span class="n">type</span><span class="p">,</span>

<span class="w">            </span><span class="nf">format</span><span class="o">=</span><span class="n">artifact</span><span class="p">.</span><span class="nf">format</span><span class="p">,</span>

<span class="w">            </span><span class="n">storage_partition</span><span class="o">=</span><span class="n">storage_partition</span><span class="p">,</span>

<span class="w">            </span><span class="k">view</span><span class="o">=</span><span class="k">view</span><span class="p">,</span>

<span class="w">        </span><span class="p">).</span><span class="n">with_content_fingerprint</span><span class="p">()</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">bulk</span><span class="vm">?</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">backends</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">transparently</span><span class="w"> </span><span class="n">batch</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">requests</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">friendly</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">transient</span><span class="w"> </span><span class="ss">&quot;.connect&quot;</span><span class="p">.</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="k">connection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">backend</span><span class="p">).</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_artifact_partitions</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">storage_partition</span><span class="p">,))</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Skip</span><span class="w"> </span><span class="n">linking</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">partition</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">affects</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="p">(</span><span class="n">which</span><span class="w"> </span><span class="n">would</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">trigger</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">change</span><span class="p">).</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">artifact</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">conn</span><span class="p">.</span><span class="n">write_snapshot_partitions</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">artifact</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">storage_partition</span><span class="p">,))</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">storage_partition</span>
</code></pre></div>

</details>
<h3 id="graphsnapshot">GraphSnapshot</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">GraphSnapshot</span><span class="p">(</span>
    <span class="n">__pydantic_self__</span><span class="p">,</span>
    <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">GraphSnapshot</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="err">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;GraphSnapshot represents the state of a Graph and the referenced raw data at a point in time.</span>

<span class="ss">    GraphSnapshot encodes the structure of the Graph plus a snapshot of the raw Artifact data</span>

<span class="ss">    (partition kinds and contents) at a point in time. Any change that would affect data should</span>

<span class="ss">    prompt an ID change.</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="nl">id</span><span class="p">:</span><span class="w"> </span><span class="n">Fingerprint</span>

<span class="w">    </span><span class="nl">graph</span><span class="p">:</span><span class="w"> </span><span class="n">Graph</span>

<span class="w">    </span><span class="nv">@property</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">artifacts</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">ArtifactBox</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">artifacts</span>

<span class="w">    </span><span class="nv">@property</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">backend</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Backend</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">backend</span>

<span class="w">    </span><span class="nv">@property</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nf">str</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">name</span>

<span class="w">    </span><span class="nv">@classmethod</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nl">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">TTL</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="vm">?</span><span class="w"> </span><span class="n">Raw</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="p">(</span><span class="n">especially</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tests</span><span class="p">)</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_graph</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="nl">graph</span><span class="p">:</span><span class="w"> </span><span class="n">Graph</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Snapshot the Graph and all existing raw data.</span>

<span class="ss">        NOTE: There is currently a gap (and thus race condition) between when the Graph ID is</span>

<span class="ss">        computed and when we read raw Artifact data during Producer builds.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">Resolve</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">statically</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">fingerprints</span><span class="p">.</span><span class="w"> </span><span class="n">Specifically</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">pin</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Producer</span><span class="p">.</span><span class="n">fingerprint</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">dynamic</span><span class="w"> </span><span class="p">(</span><span class="nl">eg</span><span class="p">:</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nc">Timestamp</span><span class="p">).</span><span class="w"> </span><span class="n">Unbuilt</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Artifact</span><span class="w"> </span><span class="p">(</span><span class="n">partitions</span><span class="p">)</span><span class="w"> </span><span class="n">won</span><span class="s1">&#39;t be fully resolved yet.</span>

<span class="s1">        snapshot_id, known_artifact_partitions = graph.fingerprint, dict[str, StoragePartitions]()</span>

<span class="s1">        for node, _ in graph.dependencies.items():</span>

<span class="s1">            snapshot_id = snapshot_id.combine(node.fingerprint)</span>

<span class="s1">            if isinstance(node, Artifact):</span>

<span class="s1">                key = graph.artifact_to_key[node]</span>

<span class="s1">                snapshot_id = snapshot_id.combine(Fingerprint.from_string(key))</span>

<span class="s1">                # Include fingerprints (including content_fingerprint!) for all raw Artifact</span>

<span class="s1">                # partitions, triggering a graph ID change if these artifacts change out-of-band.</span>

<span class="s1">                #</span>

<span class="s1">                # TODO: Should we *also* inspect Producer.inputs for Artifacts _not_ inside this</span>

<span class="s1">                # Graph and inspect their contents too? I guess we&#39;</span><span class="n">ll</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nc">bit</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">differently</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">external</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">Produced</span><span class="w"> </span><span class="p">(</span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">upstream</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="p">.</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                    </span><span class="n">known_artifact_partitions</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoragePartitions</span><span class="p">(</span>

<span class="w">                        </span><span class="k">partition</span><span class="p">.</span><span class="n">with_content_fingerprint</span><span class="p">()</span>

<span class="w">                        </span><span class="k">for</span><span class="w"> </span><span class="k">partition</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">discover_partitions</span><span class="p">()</span>

<span class="w">                    </span><span class="p">)</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">known_artifact_partitions</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="err">:</span>

<span class="w">                        </span><span class="n">content_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;partitions&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_partitioned</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="ss">&quot;data&quot;</span>

<span class="w">                        </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;No {content_str} found for `{key}`: {node}&quot;</span><span class="p">)</span>

<span class="w">                    </span><span class="n">snapshot_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">.</span><span class="n">combine</span><span class="p">(</span>

<span class="w">                        </span><span class="o">*[</span><span class="n">partition.fingerprint for partition in known_artifact_partitions[key</span><span class="o">]</span><span class="err">]</span>

<span class="w">                    </span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">.</span><span class="n">is_empty</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">.</span><span class="nl">is_identity</span><span class="p">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nl">pragma</span><span class="p">:</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">cover</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nl">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">shouldn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">unless</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">faulty</span><span class="p">.</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="ss">&quot;Fingerprint is empty!&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cls</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="n">snapshot_id</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Write</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">discovered</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">known</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">snapshot</span><span class="p">.</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="k">connection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">snapshot</span><span class="p">.</span><span class="n">backend</span><span class="p">).</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_snapshot</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">known_artifact_partitions</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span>

<span class="w">                </span><span class="n">conn</span><span class="p">.</span><span class="n">write_artifact_and_graph_partitions</span><span class="p">(</span>

<span class="w">                    </span><span class="n">snapshot</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">snapshot</span><span class="p">.</span><span class="n">artifacts</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">partitions</span>

<span class="w">                </span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">snapshot</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">executor</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Executor</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="k">from</span><span class="w"> </span><span class="n">arti</span><span class="p">.</span><span class="n">executors</span><span class="p">.</span><span class="k">local</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">LocalExecutor</span>

<span class="w">            </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalExecutor</span><span class="p">()</span>

<span class="w">        </span><span class="n">executor</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">tag</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">tag</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nl">overwrite</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="k">connection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">backend</span><span class="p">).</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_snapshot_tag</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@classmethod</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_tag</span><span class="p">(</span>

<span class="w">        </span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">tag</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nl">connectable</span><span class="p">:</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">Backend[Connection</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">Connection</span><span class="err">]</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="n">connectable</span><span class="p">.</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="n">read_snapshot_tag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">read</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="p">,</span>

<span class="w">        </span><span class="o">*</span><span class="p">,</span>

<span class="w">        </span><span class="nl">annotation</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Any</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">storage_partitions</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Sequence[StoragePartition</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">view</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">View</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">Any</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="k">read</span><span class="p">(</span>

<span class="w">            </span><span class="n">artifact</span><span class="p">,</span>

<span class="w">            </span><span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">,</span>

<span class="w">            </span><span class="n">storage_partitions</span><span class="o">=</span><span class="n">storage_partitions</span><span class="p">,</span>

<span class="w">            </span><span class="k">view</span><span class="o">=</span><span class="k">view</span><span class="p">,</span>

<span class="w">            </span><span class="n">snapshot</span><span class="o">=</span><span class="n">self</span><span class="p">,</span>

<span class="w">            </span><span class="k">connection</span><span class="o">=</span><span class="k">connection</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">write</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="ow">Any</span><span class="p">,</span>

<span class="w">        </span><span class="o">*</span><span class="p">,</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="p">,</span>

<span class="w">        </span><span class="nl">input_fingerprint</span><span class="p">:</span><span class="w"> </span><span class="n">Fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fingerprint</span><span class="p">.</span><span class="n">empty</span><span class="p">(),</span>

<span class="w">        </span><span class="nl">keys</span><span class="p">:</span><span class="w"> </span><span class="n">CompositeKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompositeKey</span><span class="p">(),</span>

<span class="w">        </span><span class="k">view</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">View</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">StoragePartition</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="k">write</span><span class="p">(</span>

<span class="w">            </span><span class="k">data</span><span class="p">,</span>

<span class="w">            </span><span class="n">artifact</span><span class="o">=</span><span class="n">artifact</span><span class="p">,</span>

<span class="w">            </span><span class="n">input_fingerprint</span><span class="o">=</span><span class="n">input_fingerprint</span><span class="p">,</span>

<span class="w">            </span><span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>

<span class="w">            </span><span class="k">view</span><span class="o">=</span><span class="k">view</span><span class="p">,</span>

<span class="w">            </span><span class="n">snapshot</span><span class="o">=</span><span class="n">self</span><span class="p">,</span>

<span class="w">            </span><span class="k">connection</span><span class="o">=</span><span class="k">connection</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro_2">Ancestors (in MRO)</h4>
<ul>
<li>arti.internal.models.Model</li>
<li>pydantic.main.BaseModel</li>
<li>pydantic.utils.Representation</li>
</ul>
<h4 id="class-variables_1">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">Config</span>
</code></pre></div>

<h4 id="static-methods_2">Static methods</h4>
<h4 id="construct_1">construct</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">construct</span><span class="p">(</span>
    <span class="n">_fields_set</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;SetStr&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">values</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<p>Creates a new model setting <strong>dict</strong> and <strong>fields_set</strong> from trusted or pre-validated data.</p>
<p>Default values are respected, but no other validation is performed.
Behaves as if <code>Config.extra = 'allow'</code> was set since it adds all passed values</p>
<h4 id="from_graph">from_graph</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_graph</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">:</span> <span class="s1">&#39;Graph&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">connection</span><span class="p">:</span> <span class="s1">&#39;Optional[Connection]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GraphSnapshot&#39;</span>
</code></pre></div>

<p>Snapshot the Graph and all existing raw data.</p>
<p>NOTE: There is currently a gap (and thus race condition) between when the Graph ID is
computed and when we read raw Artifact data during Producer builds.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@classmethod</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nl">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">TTL</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="vm">?</span><span class="w"> </span><span class="n">Raw</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="p">(</span><span class="n">especially</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tests</span><span class="p">)</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_graph</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="nl">graph</span><span class="p">:</span><span class="w"> </span><span class="n">Graph</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Snapshot the Graph and all existing raw data.</span>

<span class="ss">        NOTE: There is currently a gap (and thus race condition) between when the Graph ID is</span>

<span class="ss">        computed and when we read raw Artifact data during Producer builds.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">Resolve</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">statically</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">fingerprints</span><span class="p">.</span><span class="w"> </span><span class="n">Specifically</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">pin</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Producer</span><span class="p">.</span><span class="n">fingerprint</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">dynamic</span><span class="w"> </span><span class="p">(</span><span class="nl">eg</span><span class="p">:</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nc">Timestamp</span><span class="p">).</span><span class="w"> </span><span class="n">Unbuilt</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Artifact</span><span class="w"> </span><span class="p">(</span><span class="n">partitions</span><span class="p">)</span><span class="w"> </span><span class="n">won</span><span class="s1">&#39;t be fully resolved yet.</span>

<span class="s1">        snapshot_id, known_artifact_partitions = graph.fingerprint, dict[str, StoragePartitions]()</span>

<span class="s1">        for node, _ in graph.dependencies.items():</span>

<span class="s1">            snapshot_id = snapshot_id.combine(node.fingerprint)</span>

<span class="s1">            if isinstance(node, Artifact):</span>

<span class="s1">                key = graph.artifact_to_key[node]</span>

<span class="s1">                snapshot_id = snapshot_id.combine(Fingerprint.from_string(key))</span>

<span class="s1">                # Include fingerprints (including content_fingerprint!) for all raw Artifact</span>

<span class="s1">                # partitions, triggering a graph ID change if these artifacts change out-of-band.</span>

<span class="s1">                #</span>

<span class="s1">                # TODO: Should we *also* inspect Producer.inputs for Artifacts _not_ inside this</span>

<span class="s1">                # Graph and inspect their contents too? I guess we&#39;</span><span class="n">ll</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nc">bit</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">differently</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">external</span><span class="w"> </span><span class="n">Artifacts</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">Produced</span><span class="w"> </span><span class="p">(</span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">upstream</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="p">.</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">producer_output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                    </span><span class="n">known_artifact_partitions</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoragePartitions</span><span class="p">(</span>

<span class="w">                        </span><span class="k">partition</span><span class="p">.</span><span class="n">with_content_fingerprint</span><span class="p">()</span>

<span class="w">                        </span><span class="k">for</span><span class="w"> </span><span class="k">partition</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">discover_partitions</span><span class="p">()</span>

<span class="w">                    </span><span class="p">)</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">known_artifact_partitions</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="err">:</span>

<span class="w">                        </span><span class="n">content_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;partitions&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_partitioned</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="ss">&quot;data&quot;</span>

<span class="w">                        </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;No {content_str} found for `{key}`: {node}&quot;</span><span class="p">)</span>

<span class="w">                    </span><span class="n">snapshot_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">.</span><span class="n">combine</span><span class="p">(</span>

<span class="w">                        </span><span class="o">*[</span><span class="n">partition.fingerprint for partition in known_artifact_partitions[key</span><span class="o">]</span><span class="err">]</span>

<span class="w">                    </span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">.</span><span class="n">is_empty</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">.</span><span class="nl">is_identity</span><span class="p">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nl">pragma</span><span class="p">:</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">cover</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nl">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">shouldn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">unless</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">faulty</span><span class="p">.</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="ss">&quot;Fingerprint is empty!&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cls</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="n">snapshot_id</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Write</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">discovered</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">known</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">snapshot</span><span class="p">.</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="k">connection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">snapshot</span><span class="p">.</span><span class="n">backend</span><span class="p">).</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_snapshot</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">known_artifact_partitions</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span>

<span class="w">                </span><span class="n">conn</span><span class="p">.</span><span class="n">write_artifact_and_graph_partitions</span><span class="p">(</span>

<span class="w">                    </span><span class="n">snapshot</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">snapshot</span><span class="p">.</span><span class="n">artifacts</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">partitions</span>

<span class="w">                </span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">snapshot</span>
</code></pre></div>

</details>
<h4 id="from_orm_1">from_orm</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_orm</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="from_tag">from_tag</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_tag</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">connectable</span><span class="p">:</span> <span class="s1">&#39;Union[Backend[Connection], Connection]&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GraphSnapshot&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@classmethod</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_tag</span><span class="p">(</span>

<span class="w">        </span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">tag</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nl">connectable</span><span class="p">:</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">Backend[Connection</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">Connection</span><span class="err">]</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">GraphSnapshot</span><span class="p">:</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="n">connectable</span><span class="p">.</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="n">read_snapshot_tag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="parse_file_1">parse_file</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
    <span class="n">proto</span><span class="p">:</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">Protocol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allow_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="parse_obj_1">parse_obj</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_obj</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="parse_raw_1">parse_raw</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_raw</span><span class="p">(</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
    <span class="n">proto</span><span class="p">:</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">Protocol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allow_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="schema_1">schema</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">schema</span><span class="p">(</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ref_template</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;#/definitions/</span><span class="si">{model}</span><span class="s1">&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;DictStrAny&#39;</span>
</code></pre></div>

<h4 id="schema_json_1">schema_json</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">schema_json</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ref_template</span><span class="p">:</span> <span class="s1">&#39;unicode&#39;</span> <span class="o">=</span> <span class="s1">&#39;#/definitions/</span><span class="si">{model}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">dumps_kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;unicode&#39;</span>
</code></pre></div>

<h4 id="update_forward_refs_1">update_forward_refs</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">update_forward_refs</span><span class="p">(</span>
    <span class="o">**</span><span class="n">localns</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>Try to update ForwardRefs on fields based on this Model, globalns and localns.</p>
<h4 id="validate_1">validate</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span>
</code></pre></div>

<h4 id="instance-variables_1">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">artifacts</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">backend</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fingerprint</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">name</span>
</code></pre></div>

<h4 id="methods_2">Methods</h4>
<h4 id="build_1">build</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">build</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">executor</span><span class="p">:</span> <span class="s1">&#39;Optional[Executor]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GraphSnapshot&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">executor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Executor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphSnapshot</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">executor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="kn">from</span> <span class="nn">arti.executors.local</span> <span class="kn">import</span> <span class="n">LocalExecutor</span>

            <span class="n">executor</span> <span class="o">=</span> <span class="n">LocalExecutor</span><span class="p">()</span>

        <span class="n">executor</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>

</details>
<h4 id="copy_2">copy</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">deep</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">validate</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="s1">&#39;Any&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Self&#39;</span>
</code></pre></div>

<p>Duplicate a model, optionally choose which fields to include, exclude and change.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>include</td>
<td>None</td>
<td>fields to include in new model</td>
<td>None</td>
</tr>
<tr>
<td>exclude</td>
<td>None</td>
<td>fields to exclude from new model, as with values this takes precedence over include</td>
<td>None</td>
</tr>
<tr>
<td>update</td>
<td>None</td>
<td>values to change/add in the new model. Note: the data is not validated before creating</td>
<td></td>
</tr>
<tr>
<td>the new model: you should trust this data</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>deep</td>
<td>None</td>
<td>set to <code>True</code> to make a deep copy of the model</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>new model instance</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">deep</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span><span class="p">,</span><span class="w"> </span><span class="n">validate</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="o">:</span><span class="w"> </span><span class="k">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Self</span><span class="o">:</span>

<span class="w">        </span><span class="n">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">super</span><span class="p">().</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">validate</span><span class="o">:</span>

<span class="w">            </span><span class="c1"># NOTE: We set exclude_unset=False so that all existing defaulted fields are reused (as</span>

<span class="w">            </span><span class="c1"># is normal `.copy` behavior).</span>

<span class="w">            </span><span class="c1">#</span>

<span class="w">            </span><span class="c1"># To reduce `repr` noise, we&#39;ll reset .__fields_set__ to those of the pre-validation copy</span>

<span class="w">            </span><span class="c1"># (which includes those originally set + updated).</span>

<span class="w">            </span><span class="n">fields_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">.</span><span class="n">__fields_set__</span>

<span class="w">            </span><span class="n">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span>

<span class="w">                </span><span class="n">dict</span><span class="p">(</span><span class="n">copy</span><span class="p">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">to_dict</span><span class="o">=</span><span class="no">False</span><span class="p">,</span><span class="w"> </span><span class="n">by_alias</span><span class="o">=</span><span class="no">False</span><span class="p">,</span><span class="w"> </span><span class="n">exclude_unset</span><span class="o">=</span><span class="no">False</span><span class="p">))</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="c1"># Use object.__setattr__ to bypass frozen model assignment errors</span>

<span class="w">            </span><span class="n">object</span><span class="p">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;__fields_set__&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">set</span><span class="p">(</span><span class="n">fields_set</span><span class="p">))</span>

<span class="w">            </span><span class="c1"># Copy over the private attributes, which are missing after validation (since we&#39;re only</span>

<span class="w">            </span><span class="c1"># passing the fields).</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">__private_attributes__</span><span class="o">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">getattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="k">Undefined</span><span class="p">))</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">Undefined</span><span class="o">:</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">deep</span><span class="o">:</span>

<span class="w">                        </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deepcopy</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>

<span class="w">                    </span><span class="n">object</span><span class="p">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">copy</span>
</code></pre></div>

</details>
<h4 id="dict_1">dict</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">dict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">include</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">skip_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;DictStrAny&#39;</span>
</code></pre></div>

<p>Generate a dictionary representation of the model, optionally specifying which fields to include or exclude.</p>
<h4 id="json_1">json</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">json</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">include</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;AbstractSetIntStr&#39;</span><span class="p">),</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;MappingIntStrAny&#39;</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">skip_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">encoder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">models_as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">dumps_kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;unicode&#39;</span>
</code></pre></div>

<p>Generate a JSON representation of the model, <code>include</code> and <code>exclude</code> arguments as per <code>dict()</code>.</p>
<p><code>encoder</code> is an optional function to supply as <code>default</code> to json.dumps(), other arguments as per <code>json.dumps()</code>.</p>
<h4 id="read_1">read</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">artifact</span><span class="p">:</span> <span class="s1">&#39;Artifact&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">annotation</span><span class="p">:</span> <span class="s1">&#39;Optional[Any]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_partitions</span><span class="p">:</span> <span class="s1">&#39;Optional[Sequence[StoragePartition]]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">view</span><span class="p">:</span> <span class="s1">&#39;Optional[View]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">connection</span><span class="p">:</span> <span class="s1">&#39;Optional[Connection]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Any&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">read</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="p">,</span>

<span class="w">        </span><span class="o">*</span><span class="p">,</span>

<span class="w">        </span><span class="nl">annotation</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Any</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">storage_partitions</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Sequence[StoragePartition</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">view</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">View</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">Any</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="k">read</span><span class="p">(</span>

<span class="w">            </span><span class="n">artifact</span><span class="p">,</span>

<span class="w">            </span><span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">,</span>

<span class="w">            </span><span class="n">storage_partitions</span><span class="o">=</span><span class="n">storage_partitions</span><span class="p">,</span>

<span class="w">            </span><span class="k">view</span><span class="o">=</span><span class="k">view</span><span class="p">,</span>

<span class="w">            </span><span class="n">snapshot</span><span class="o">=</span><span class="n">self</span><span class="p">,</span>

<span class="w">            </span><span class="k">connection</span><span class="o">=</span><span class="k">connection</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="tag">tag</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">tag</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">connection</span><span class="p">:</span> <span class="s1">&#39;Optional[Connection]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;None&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">tag</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">tag</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nl">overwrite</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span><span class="w"> </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="k">connection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">backend</span><span class="p">).</span><span class="k">connect</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">conn</span><span class="p">:</span>

<span class="w">            </span><span class="n">conn</span><span class="p">.</span><span class="n">write_snapshot_tag</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="write_1">write</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="s1">&#39;Any&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">artifact</span><span class="p">:</span> <span class="s1">&#39;Artifact&#39;</span><span class="p">,</span>
    <span class="n">input_fingerprint</span><span class="p">:</span> <span class="s1">&#39;Fingerprint&#39;</span> <span class="o">=</span> <span class="n">Fingerprint</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">keys</span><span class="p">:</span> <span class="s1">&#39;CompositeKey&#39;</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">view</span><span class="p">:</span> <span class="s1">&#39;Optional[View]&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">connection</span><span class="p">:</span> <span class="s1">&#39;Optional[Connection]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;StoragePartition&#39;</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">write</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="k">data</span><span class="err">:</span><span class="w"> </span><span class="ow">Any</span><span class="p">,</span>

<span class="w">        </span><span class="o">*</span><span class="p">,</span>

<span class="w">        </span><span class="nl">artifact</span><span class="p">:</span><span class="w"> </span><span class="n">Artifact</span><span class="p">,</span>

<span class="w">        </span><span class="nl">input_fingerprint</span><span class="p">:</span><span class="w"> </span><span class="n">Fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fingerprint</span><span class="p">.</span><span class="n">empty</span><span class="p">(),</span>

<span class="w">        </span><span class="nl">keys</span><span class="p">:</span><span class="w"> </span><span class="n">CompositeKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompositeKey</span><span class="p">(),</span>

<span class="w">        </span><span class="k">view</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">View</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="k">connection</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">StoragePartition</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="k">write</span><span class="p">(</span>

<span class="w">            </span><span class="k">data</span><span class="p">,</span>

<span class="w">            </span><span class="n">artifact</span><span class="o">=</span><span class="n">artifact</span><span class="p">,</span>

<span class="w">            </span><span class="n">input_fingerprint</span><span class="o">=</span><span class="n">input_fingerprint</span><span class="p">,</span>

<span class="w">            </span><span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>

<span class="w">            </span><span class="k">view</span><span class="o">=</span><span class="k">view</span><span class="p">,</span>

<span class="w">            </span><span class="n">snapshot</span><span class="o">=</span><span class="n">self</span><span class="p">,</span>

<span class="w">            </span><span class="k">connection</span><span class="o">=</span><span class="k">connection</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span>
</code></pre></div>

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../fingerprints/" title="Fingerprints" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Fingerprints
              </span>
            </div>
          </a>
        
        
          <a href="../" title="Index" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Index
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
    
  </body>
</html>